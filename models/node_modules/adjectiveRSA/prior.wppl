var binParam = 5;

var round = function(x){
  return Math.round(x*10)/10
}

var stateParams = {
  sub: {mu: 5, sigma: 0.5},
  super: {mu: 3, sigma: 1}
}

var stateVals = map(
  round,
  _.range(stateParams.super.mu - 2 * stateParams.super.sigma,
          stateParams.super.mu + 2 * stateParams.super.sigma,
          stateParams.super.sigma/binParam)
);

var stateProbs = {
  sub: map(function(s){
    Math.exp(Gaussian(stateParams.sub).score(s));
  }, stateVals),
  super: map(function(s){
    Math.exp(Gaussian(stateParams.super).score(s));
  }, stateVals)
};

var statePrior = {
  sub: Infer({
    model: function(){ return categorical({vs: stateVals, ps: stateProbs.sub}) }
  }),
  super: Infer({
    model: function(){
      return categorical({
        vs: stateVals,
        ps: stateProbs.super
      })
    }
  })
};

var classPrior = Infer({model: function(){return uniformDraw(["sub", "super"])}});

var thresholdBins ={
  positive: map(function(x){
    return  x - (1/(binParam*2));
  }, sort(statePrior.super.support())),
  negative: map(function(x){
    return  x + (1/(binParam*2));
  }, sort(statePrior.super.support()))
};

var thresholdPrior = {
  positive: Infer({
    model: function() { return uniformDraw(thresholdBins.positive) }
  }),
  negative: Infer({
    model: function() { return uniformDraw(thresholdBins.negative) }
  })
};

var utterances = {
  positive: ["positiveAdjective", "silence"],
  negative: ["negativeAdjective", "silence"]
};

var utterancePrior = {
  positive: Infer({
    model: function() { return uniformDraw(utterances.positive) }
  }),
  negative: Infer({
    model: function() { return uniformDraw(utterances.negative) }
  })
};


var meaning = function(utterance, state, threshold) {
  utterance == "positiveAdjective" ? state > threshold :
  utterance == "negativeAdjective" ? state < threshold :
  true
}
