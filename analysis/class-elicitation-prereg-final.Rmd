---
title: "Comparison class elicitation (final) pilot"
author: "MH Tessler"
date: "October 29, 2019"
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Load libraries.
library(knitr)
library(tidyverse)
library(jsonlite)
library(tidyboot)
library(tidytext)
library(lme4)
library(ggthemes)
library(brms)
library(stringr)
theme_set(theme_few())

# extended function to check matching between strings either way 
containsString_responses <- function(strng, substrng, clean_str, us_substr){
  return(ifelse(length(strsplit(strng, substrng)[[1]]) > 1, 1, 
                ifelse( length(strsplit(us_substr, clean_str)[[1]]) > 1, 1, 0)))
}
containsString <- function(strng, substrng){
  return(ifelse(length(strsplit(strng, substrng)[[1]]) > 1, 1, 
                ifelse( length(strsplit(substrng, strng)[[1]]) > 1, 1, 0)))
}

my_stop_words <- stop_words %>% rowwise() %>%
    subset(!(stop_words$word %in% c("rooms", "year", "side", "area", "of", "up", "great", "things")))

```

### Load data


```{r load data from json, eval = F}
data.path <- "../mturk/class-elicitation-prereg-final/production-results/"
result.files <- list.files(data.path, pattern="json")

df.subject <- data.frame()
df.trials <- data.frame()
df.attention <- data.frame()
for (result_file in result.files) {
  result_json = fromJSON(paste(data.path, result_file, sep ="/"))
  worker.id = paste("workerid_", str_pad(match(result_file, result.files), 4, pad="0"), sep = "")
#  result_json$WorkerId
  condition = result_json$answers$condition
  
  df.attention = bind_rows(
    df.attention, 
    data.frame(result_json$answers$catch_trials) %>%
      mutate(workerid = worker.id)
  )
    
  df.subject = bind_rows(
    df.subject, 
    data.frame(result_json$answers$subject_information) %>% 
      mutate(
        workerid = worker.id,
        language = gsub("\"", "", language),
        enjoyment = gsub("\"", "", enjoyment),
        age = gsub("\"", "", age),
        gender = gsub("\"", "", gender),
        problems = gsub("\"", "", problems),
        comments = gsub("\"", "", comments)
      ) 
  )
    
  df.trials = bind_rows(
    df.trials, 
    data.frame(result_json$answers$trials) %>%
      mutate(workerid = worker.id)
  )
}


write_csv(df.trials, "../data/class-elicitation-prereg-final/class-elicitation-prereg-final-trials.csv")
write_csv(df.subject, "../data/class-elicitation-prereg-final/class-elicitation-prereg-final-subject_information.csv")
write_csv(df.attention, "../data/class-elicitation-prereg-final/class-elicitation-prereg-final-catch_trials.csv")
```


```{r load data from csv}
df.trials <- read_csv("../data/class-elicitation-prereg-final/class-elicitation-prereg-final-trials.csv")
df.subject <- read_csv("../data/class-elicitation-prereg-final/class-elicitation-prereg-final-subject_information.csv")
df.attention <- read_csv("../data/class-elicitation-prereg-final/class-elicitation-prereg-final-catch_trials.csv")
#df.frequencies <- read_csv("../data/pilot-classElicitation-free-4/webgram-freqs-unique-nps.csv")
```


### Exclusion criteria

```{r}

df.botcaptcha <- df.attention %>%
  filter(condition == "botcaptcha")

df.comprehension <- df.attention %>%
  filter(condition == "warm_up") %>%
  rowwise() %>%
  mutate(pass_comp = (
    containsString(tolower(response), "build") | 
      containsString(tolower(response), "bulid") | 
      containsString(tolower(response), "buid") |
      containsString(tolower(response), "skyscraper") | 
      containsString(tolower(response), "skyscaper") | 
      containsString(tolower(response), "structure") | 
      containsString(tolower(response), "bulding") | 
      containsString(tolower(response), "builing") |
      containsString(tolower(response), "bildin") |
      containsString(tolower(response), "towe")
      ))

df.comprehension %>%
  filter(!pass_comp) %>% 
  View()

df.memory <- df.attention %>%
  filter(condition == "memory_check") %>%
  group_by(workerid) %>%
  summarize(n_correct = sum(correct),
            pass_memory = n_correct >= 7)

```


```{r}
df.memory %>%
  group_by(n_correct) %>%
  count()
```

```{r summarize catch trials}
df.attention.summary <- left_join(
  df.comprehension %>% select(workerid, pass_comp), 
  df.memory %>% select(workerid, pass_memory)) %>%
  mutate(pass_both = pass_comp & pass_memory)
  

df.attention.summary %>%
  group_by(pass_comp, pass_memory, pass_both) %>%
  count()
```

``` {r pluralNP insertion}
# insert plural noun phrases additionally to recorded seed NPs in order to use plural frequencies 
# THE ORIGINAL NPs ARE USED, NOT THE SUBSTITUTED ONES

# this will be used for the frequency data 
insert_plural_np = function(np) {
  if (np %in% c("seagull", "parrot", "crow", "day", "dusk", "night", "jolly rancher", "marshmallow",
               "tile", "carpet", "giraffe", "monkey", "bird", "donkey", "dog", "cat", "elephant", "cheetah",
               "sloth","basketball player", "golfer", "jockey", "runner", "jogger", "walker", "dachshund",
               "bassett hound", "chihuahua", "novel", "poem", "classroom", "study hall", "tree", "flower",
               "adult", "teenager",  "kid", "hurricane", "thunderstorm", "rain", "soup", "salad",
               "cave", "cavern", "fox hole", "highway", "side road", "downtown street"))  {
    np_pl = paste(np, "s", sep="")
  } else if (np %in% c("piece of chocolate" )) {
    np_pl = "pieces of chocolate"
  } else if (np %in% c( "fish", "wood", "platinum", "bronze", "plastic",  "ice cream", 
                       "summer", "fall", "winter" )) {
    np_pl = np
  } else if( np %in% c("story")) {
    np_pl = "stories"
  } else if( np %in% c("mouse")) {
    np_pl = "mice"
  } else if( np %in% c("auditorium")) {
    np_pl = "auditoria"
  } else if (np %in% c("bottle of top-shelf liquor")) {
    np_pl = "liquors"
  } else if (np %in% c("six-pack of beer")) {
    np_pl = "beers"
  } else if (np %in% c( "bottle of wine")) {
    np_pl = "bottles of wine"
  } else if (np %in% c( "bush" )) {
    np_pl = "bushes"
  } else if(np %in% c( "child")) {
    np_pl = "children"
  } else if (np %in% c("baby")) {
    np_pl = "babies"
  } else {
    np_pl = np
  }
  return (np_pl)
}

df.trials.w.pluralNP <- df.trials %>% 
  rowwise() %>% 
  mutate(np_pl = insert_plural_np(np))

```


## Response processing


For automated checking of whether or not responses contain the supplied NP, we distill multi-word NPs (e.g., "six-pack of beer") to single words (e.g., beer) that we think convey the essence of the category given the context. And so, if we see a response containing the word "beer", then it will be marked as *specific* (or, including the mentioned NP). However, there are certian patterns that we deem ambiguous (e.g., using the word: "similar"), and we exclude these *($n = ?? $)*. Just to confirm, in addition, we hand-check all responses. 

```{r filtered main trails}
df.trials.filtered <- df.trials %>%
  left_join(., df.attention.summary) %>%
  filter(pass_both) %>%
  rowwise() %>%
  mutate(
    np_match = tolower(np), # additional column where we put the NP to be matched against, such that the original NPs can be accessed if necessary
    np_match = gsub("bottle of top-shelf liquor", "liquor", np_match),
    np_match = gsub("piece of chocolate", "chocolate", np_match),
    np_match = gsub("piece of chalk", "chalk", np_match),
    np_match = gsub("six-pack of beer", "beer", np_match),
    np_match = gsub("bottle of wine", "wine", np_match),
    np_match = gsub("pine tree", "pine", np_match),
    np_match = gsub("redwood tree", "redwood", np_match),
    np_match = gsub("alpine tree", "alpine", np_match),
    np_match = gsub("bonsai tree", "bonsai", np_match),
    np_match = gsub("pick-up truck", "pick-up", np_match),
    np_match = gsub("relay race", "relay", np_match),
    np_match = gsub("triathlon race", "triathlon", np_match),
    np_match = gsub("sprinting race", "sprint", np_match),
    np_match = gsub("kettle ball", "ball", np_match),
    np_match = gsub("study hall", "study", np_match),
    np_match = gsub("electric car", "electric", np_match),
    np_match = gsub("bass guitar", "bass", np_match),
    np_match = gsub("choral concert", "choral", np_match),
    np_match = gsub("rap concert", "rap", np_match),
    np_match = gsub("white paint", "white", np_match),
    np_match = gsub("blue paint", "blue", np_match),
    np_match = gsub("black paint", "black", np_match),
    np_match = gsub("limousine", "limo", np_match),
    np_match = gsub("smartcar", "smart", np_match),
    np_match = gsub("japanese restaurant", "japanese", np_match),
    np_match = gsub("chinese restaurant", "chinese", np_match),
    np_match = gsub("korean restaurant", "korean", np_match),
    np_match = gsub("elderly person", "elder", np_match),
    np_match = gsub("oil paint", "oil", np_match),
    np_match = gsub("wall paint", "wall", np_match),
    np_match = gsub("shopping mall", "mall", np_match),
    np_match = gsub("chocolate fondue", "fondue", np_match),
    np_match = gsub("cell phone", "phone", np_match),
    np_match = gsub("bear den", "bear", np_match),
    np_match = gsub("fox den", "fox", np_match),
    np_match = gsub("mouse den", "mouse", np_match),
    np_match = gsub("downtown street", "downtown", np_match),
    np_match = gsub("side road", "side", np_match),
    np_match = gsub("back door", "back", np_match),
    np_match = gsub("patio door", "patio", np_match),
    np_match = gsub("chocolate cake", "chocolate", np_match)
    )


df.trials.filtered %>% 
  group_by(degree, np) %>%
  count()
```


```{r}
d.item.count <- df.trials.filtered %>%
  group_by(stim_id, np_expectations, adj_polarity) %>%
  count() 
d.item.count

d.item.count %>% 
  ungroup() %>% 
  group_by(n) %>% 
  count()

```


```{r}
d.item.n50 <- d.item.count %>% 
  filter(n >= 50) 
 write(
   jsonlite::toJSON(d.item.n50, pretty = T),
   file = "../experiments/js/prereg-cce-n50.json"
 )

```

We exclude invalid responses: These are the responses the are just the name of a person or just the adjective.
After the responses are analysed manually, nonsense responses were added to this list. 
``` {r excludeInvalidResps}
# excluding invalid responses 
d.tidy.resp.valid.resps <- df.trials.filtered %>% rowwise() %>%
  subset(., !(response %in% c("unsure", "long", "short", "tall", "dark", "light", "fast", "quick", "slow", "hard", "soft", "loud", "noisy", "quiet", 
                                    # all the adjectives
                                    "expensive", "cheap", "big", "small", "strong", "weak", "warm", "hot", "cold", "heavy", "wide", "narrow",
                                    "alexander", "alicia", "cheep", "daniel", "darker", "david", "easy", "empire building",
                                    "eric", "gabriel", "anthony", "william", "john", "tom", "lucas", "michael", "cameron", "stephen", # all the referent names
                                    "lee", "greg", "robert", "chrales",  "gary", "josh", "simon", 
                                    "angela", "jennifer", "monica", "melinda", "veronica", "alicia", "maya", "sophie", "kim", "laura", "julia",
                                    "michelle", "stephanie", "claire", "kathleen", "jasmine", "tanya", "mika", "natalia", "barbell snatch", "bank of america",
                                    "exensive", "finished", "flexibility", "health", "hot cold", "lazy", "low", # extracted invalid resps
                                    "public", "ripe" , "silent", "baked")))
```


We correct for common misspellings in the responses and normalize irregular forms to match our supplied NP. 

```{r misspellings and irregular plurals}
d.tidy.resp.valid.resps %>% 
  mutate(response = as.character(response),
         response = gsub("&quotechar", "", response),
         response = gsub("biking", "bike", response),
         response = gsub("bicycle", "bike", response),
         response = gsub("car ride", "drive", response),
         response = gsub("babies", "baby", response),
         response = gsub("stories", "story", response),
         response = gsub("basset", "bassett", response),
         response = gsub("dasies", "daisy", response),
         response = gsub("pansies", "pansy", response),
         response = gsub("mice", "mouse", response),
         response = gsub("documentaries", "documentary", response),
         response = gsub("parties", "party", response),
         response = gsub("libraries", "library", response),
         response = gsub("cities", "city", response),
         response = gsub("auditoria", "auditorium", response),
         response = gsub("gymnasia", "gymnasium", response),
         response = gsub("cacti", "cactus", response),
         response = gsub("pantries", "pantry", response),
         response = gsub("bonzai", "bonsai", response),
         response = gsub("seagul", "seagull", response),
         response = gsub("seagulll", "seagull", response),
         response = gsub("dalia", "dahlia", response),
         response = gsub("pitbul", "pitbull", response),
         response = gsub("panter", "panther", response),
         response = gsub("icecream", "ice cream", response),
         response = gsub("ice-cream", "ice cream", response),
         response = gsub("bed board", "bedboard", response),
         response = gsub("jocky", "jockey", response),
         response = gsub("jockie", "jockey", response),
         response = gsub("gym", "gymnasium", response),
         response = gsub("dog house", "doghouse", response),
         response = gsub("fridge", "refrigerator", response),
         response = gsub("chihuaua", "chihuahua", response),
         response = gsub("zuccini", "zucchini", response),
         response = gsub("cheeta", "cheetah", response),
         response = gsub("skiier", "skier", response),
         response = gsub("cooking", "cookware", response),
         response = gsub("mobile", "cell", response),
         response = gsub("dachsund", "dachshund", response),
         response = gsub("floor surfaces", "floors", response),
         response = gsub("floor materials", "floors", response),
         response = gsub("flooring", "floors", response),
         response = gsub("liquors", "liquor", response),
         response = gsub("monkies", "monkey", response),
         response = gsub("brushes", "bushes", response),
         response = gsub("poetry", "poem", response),
         response = gsub("marshmellow", "marshmallow", response),
         response = gsub("cow", "crow", response),
         response = gsub("burrow", "hole", response),
         response = gsub("jokceys", "jockeys", response),
         response = gsub("golf player", "golfer", response),
         response = gsub("marshamallow", "marshmallow", response),
         response = gsub("colour", "color", response),
         response = gsub("times of the day", "times of day", response),
         response = gsub("pickup", "pick-up", response),
         response = gsub("segalls", "seagulls", response),
         response = gsub("triatlon", "triathlon", response),
         response = gsub("intrument", "instrument", response),
         response = gsub("desert", "dessert", response),
         response = gsub("eliphant", "elephant", response),
         response = gsub("pick up", "pick-up", response),
         response = gsub("chruch", "church", response),
         response = gsub("coffe", "coffee", response),
         response = gsub("resturauants", "restaurants", response),
         response = gsub("piillow", "pillow", response),
         response = gsub("thunderstom", "thunderstorm", response),
         response = gsub("quitar", "guitars", response),
         response = gsub("monkees", "monkey", response),
         response = gsub("watermellons", "watermelon", response),
         response = gsub("penquin", "penguin", response),
         response = gsub("liqueur", "liquor", response),
         response = gsub("elelphant", "elephant", response),
         response = gsub("millshake", "milkshake", response),
         response = gsub("alcohol drinks", "alcoholic drinks", response),
         response = gsub("milshakes", "milkshake", response),
         response = gsub("appliences", "appliances", response),
         response = gsub("watermenlons", "watermelon", response),
         response = gsub("docuentaries", "documentary", response),
         response = gsub("braclets", "bracelets", response),
         response = gsub("oragnes", "orange", response),
         response = gsub("trashcans", "trash can", response),
         response = gsub("jollies", "jolly rancher", response),
         response = gsub("monekys", "monkey", response),
         response = gsub("ukulele", "ukelele", response),
         response = gsub("pit bulls", "pitbull", response),
         response = gsub("pod cast", "podcast", response),
         response = gsub("parites", "party", response),
         response = gsub("dachunds", "dachshund", response),
         response = gsub("resaurants", "restaurants", response),
         response = gsub("peom", "poem", response),
         response = gsub("braclet", "bracelet", response),
         response = gsub("pick truck", "pick-up truck", response),
         response = gsub("bassettt hound", "bassett hound", response),
         response = gsub("summre", "summer", response),
         response = gsub("blwnket", "blanket", response),
         response = gsub("fondu's", "fondue", response),
         response = gsub("aplaince", "appliance", response),
         response = gsub("restarant", "restaurant", response),
         response = gsub("concert's", "concerts", response),
         response = gsub("chihuaha", "chihuahua", response),
         response = gsub("chiahuahaua", "chihuahua", response),
         response = gsub("cotten", "cotton", response),
         response = gsub("cumcumber", "cucumber", response),
         response = gsub("daschshunds", "dachshund", response),
         response = gsub("aparments", "apartment", response),
         response = gsub("basket ball", "basketball", response),
         response = gsub("bassettts", "bassett hound", response),
         response = gsub("dashshunds", "dachshund", response),
         response = gsub("fruitcake", "fruit cake", response),
         response = gsub("joly ranchers", "jolly rancher", response),
         response = gsub("libaries", "library", response),
         response = gsub("liqour", "liquor", response),
         response = gsub("magoes", "mango", response),
         response = gsub("mialkshakes", "milkshake", response),
         response = gsub("monkys", "monkey", response),
         response = gsub("organes", "orange", response),
         response = gsub("palnes", "plane", response),
         response = gsub("paties", "party", response),
         response = gsub("runer", "runner", response),
         response = gsub("pencial's", "pencil", response),
         response = gsub("rapberriees", "raspberries", response),
         response = gsub("wilk", "silk", response),
         response = gsub("watermeloons", "watermelon", response),
         response = gsub("water color", "watercolor", response),
         response = gsub("villiages", "village", response),
         response = gsub("thundersorm", "thunderstorm", response),
         response = gsub("tennager", "teenager", response),
         response = gsub("stirps", "strip mall", response),
         response = gsub("adukts", "adults", response),
         response = gsub("afults", "adults", response),
         response = gsub("blwnkets", "blankets", response),
         response = gsub("bottles of win", "wine", response),
         response = gsub("boulevatd", "boulevard", response),
         response = gsub("bracelet's", "bracelets", response),
         response = gsub("bracelts", "bracelets", response),
         response = gsub("centre", "center", response),
         response = gsub("frinch", "finch", response),
         response = gsub("croe", "crow", response),
         response = gsub("dane's", "danes", response),
         response = gsub("documentry", "documentary", response),
         response = gsub("greats danes", "great dane", response),
         response = gsub("gutiars", "guitars", response),
         response = gsub("manos", "mangos", response),
         response = gsub("paint's", "paints", response),
         response = gsub("raspberriees", "raspberries", response),
         response = gsub("rental options", "rentals", response),
         response = gsub("resturants", "restaurants", response),
         response = gsub("restaurnats", "restaurants", response),
         response = gsub("restuarants", "restaurants", response),
         response = gsub("sald", "salad", response),
         response = gsub("satues", "statues", response),
         response = gsub("sanddals", "sandals", response),
         response = gsub("shes", "shoes", response),
         response = gsub("skarks", "shark", response),
         response = gsub("skyscrapper", "skyscraper", response),
         response = gsub("spirinting", "sprinting", response),
         response = gsub("statue's", "statues", response),
         response = gsub("statutes", "statues", response),
         response = gsub("thundersorms", "thunderstorm", response),
         )  -> df.trials.filtered.spelling
```


We treat certain responses as synonymous with our supplied NPs given the context.

We also replace a few common responses with synonyms, which match our supplied NPs better (e.g., NP =  "car ride", common response = "other drives"). Some replacements are more specific 
(Based on pilot data, specific mistakes and synonyms are converted to the seed NPs.). 
All irregular plurals in the set set are converted to singulars to match the seed noun phrase. 


```{r}
df.trials.filtered.spelling %>% 
  mutate(response = gsub("6 packs", "beer", response),
         response = gsub("six-packs", "beer", response),
         response = gsub("six-pack", "beer", response),
         response = gsub("six packs", "beer", response),
         response = gsub("beverage", "drink", response),
         response = gsub("humans", "people", response),
         response = gsub("persons", "people", response),
         response = gsub("individuals", "people", response),
         response = gsub("brands of beer", "beer", response),
         response = gsub("players that play a different sport", "athletes", response),
         response = gsub("hours of the day", "times of day", response),
         response = gsub("book", "readings", response),
         response = gsub("times of the year", "seasons", response),
         response = gsub("times of year", "seasons", response),
         response = gsub("conference room", "conference center", response),
         response = gsub("clothing", "clothes", response),
         response = gsub("parts of the day", "times of day", response),
         response = gsub("caves", "dens", response),
         response = gsub("cushion", "pillow", response),
         response = gsub("times when it is not as dark", "times of day", response),
         response = gsub("flying vehicles", "aircrafts", response),
         response = gsub("flying objects", "aircrafts", response),
         response = gsub("flying machines", "aircrafts", response),
         response = gsub("race courses", "races", response),
         response = gsub("race paths", "races", response),
         response = gsub("day times", "times of day", response), 
         response = gsub("restaurant menu", "restaurant", response),
         response = gsub("footwear", "shoes", response),
         response = gsub("alochols", "alcoholic drinks", response),
         response = gsub("gates", "gate", response),
         response = gsub("berry", "berries", response),
         response = gsub("basket athletes", "basketball players", response),
         response = gsub("alcohol drink", "alcoholic drink", response),
         response = gsub("allies", "alley", response),
         response = gsub("animal home", "den", response),
         response = gsub("daisies", "daisy", response),
         response = gsub("chijldren", "child", response),
         response = gsub("childern", "child", response),
         response = gsub("child fussy", "child", response),
         response = gsub("choirs", "choral", response),
         response = gsub("animals houses", "dens", response),
         response = gsub("rock music", "rock concert", response),
         response = gsub("patios", "patio door", response),
         response = gsub("rug", "carpet", response),
         response = gsub("wooffloor", "wood", response),
         response = gsub("pet mouose", "mouse", response),
         response = gsub("fungus", "mushroom", response),
         response = gsub("episodes of this podcast", "podcast episode", response),
         response = gsub("flat", "apartment", response),
         response = gsub("libraries", "library", response),
         response = gsub("pans for frying", "frying pans", response),
         response = gsub("pickup's", "pick-up truck", response),
         response = gsub("pick up track", "pick-up truck", response),
         response = gsub("podcasts he has heard", "podcast episode", response),
         response = gsub("podcasts listened", "podcast episode", response),
         response = gsub("podcasts", "podcast episode", response),
         response = gsub("sofa", "couch", response),
         response = gsub("teens", "teenager", response),
         ) -> df.trials.filtered.spellsyn
```

```{r codeForSubCatTerms}

# clean produced responses to match NPs 
df.trials.filtered.spellsyn %>% 
  unnest_tokens(word, response)  %>%  # break responses into single words (one per line)
  anti_join(my_stop_words) %>%  # remove stop words
  group_by(workerid, trial_num) %>% # next four functions are to put phrases back together again
  mutate(wordNumber = paste("word_", row_number(), sep = "")) %>%
  spread(wordNumber, word) %>%
  unite(phrase, starts_with("word_"), sep = " ") %>%
  mutate(phrase = gsub(" NA", "", phrase)) %>%
  left_join(
    df.trials.filtered %>% 
      select(workerid, trial_num, response)
    ) %>% 
  rename(cleanedPhrase = phrase, originalResponse = response) %>% 
  rowwise() %>%
  mutate(
    originalPhrase = as.character(cleanedPhrase),
    cleanedPhrase = paste("_", as.character(cleanedPhrase), "_", sep = ""), # add buffer to allow for split to occur at beginning or end
    np_match = as.character(np_match),
    np_match = gsub('\"', "", np_match),
    np_match_us = paste("_", np_match, "_", sep=""), # insert underscores for the matching the other way around 
    super_us = paste("_", superordinate, "_", sep=""),
  # check if response and seed NP match 
    specific = containsString_responses(
      as.character(cleanedPhrase), 
      np_match, 
      originalPhrase, 
      np_match_us
      ),
  # check if response and anticipated superordinate match
    matchingSuper = containsString_responses(
      as.character(cleanedPhrase), 
      as.character(superordinate), 
      originalPhrase, 
      super_us)
  ) -> d.tidy.phrase.w.original
 
d.tidy.phrase.w.original %>%
  group_by(stim_id, np_expectations, adj_polarity) %>%
  count()
```

There are 19906 (of 23758) automatically classified responses responseswhich passed the first round of exclusion (responses which are just actor names or adjectives and several invalid responses). 

``` {r}
# extrcat the automatically matched data
d.matchedResponses <- d.tidy.phrase.w.original %>% filter((specific == 1) | (matchingSuper == 1))

# extract the consistent responses based on automatically classified data
d.sub.counts <- d.matchedResponses %>%
  group_by(stim_id, np_expectations, adj_polarity) %>%
  count(specific)
d.sub.counts
d.consistent.items <- d.sub.counts %>% 
  group_by(stim_id, np_expectations, adj_polarity) %>% 
  mutate(nr_dp = sum(n)) %>% 
  filter(n >= nr_dp-2) # extract the consistent items 

d.consistent.items
d.inconsistent.items <- anti_join(d.sub.counts, d.consistent.items)
d.inconsistent.items
```


``` {r nonMatchedResps}
# look at the unique non-matched responses
d.tidy.resp.analysis <- anti_join(d.tidy.phrase.w.original, d.matchedResponses)

d.tidy.resp.analysis %>% distinct(degree, superordinate, super_us, np, adj, np_match, np_match_us, cleanedPhrase, originalResponse, originalPhrase, specific, matchingSuper) %>% View()
```

Here, we look at the responses that were not matched to our anticipated NPs and superordinates and the synonyms of the NPs we already caught. We judge if the deviating responses are synonymous to our seed NPs or our superordinates and match them.
``` {r}
# categorize the responses upon looking at the reponses not matching the NP nor the superordinate
d.tidy.phrase.handClassified <- d.tidy.resp.analysis %>% 
  
  mutate(cat_cleanedPhrase = cleanedPhrase,
         cat_cleanedPhrase = ifelse( superordinate == "cookware", gsub("pans", "frying pan", cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("flying crafts", "aircrafts", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("passageways", "doorways", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("mattresses", "bedboard", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("areas around", "areas", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("hours", "times of day", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("animal movement", "animal", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("home", "house", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("door passages", "doorways", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("liquid", "drink", cat_cleanedPhrase),
        
         cat_cleanedPhrase = gsub("shows", "entertainment", cat_cleanedPhrase),
  
         cat_cleanedPhrase = gsub("roadway", "road", cat_cleanedPhrase),
        
         cat_cleanedPhrase = gsub("liuids", "drinks", cat_cleanedPhrase),
        
      
         cat_cleanedPhrase = gsub("watercraft", "boat", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("types of restaurant food", "restaurants", cat_cleanedPhrase),
    
         cat_cleanedPhrase = gsub("similar shakes", "milkshake", cat_cleanedPhrase),
         
         cat_cleanedPhrase =ifelse(degree == "darkness",  gsub("times", "times of day", cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("top shelf options", "liquor", cat_cleanedPhrase),
        
         cat_cleanedPhrase = gsub("shades", "paint", cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "price", gsub("rent", "rentals", cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("other computer equipment", "electronic devices", cat_cleanedPhrase),
         
         cat_cleanedPhrase = gsub("bodies of water", "waterways", cat_cleanedPhrase),
         
         cat_cleanedPhrase = gsub("places to rent", "rentals", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("ways too cook food", "cookware", cat_cleanedPhrase),
         
         
         cat_cleanedPhrase = gsub("paint colors", "paints", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("door openings", "doorways", cat_cleanedPhrase),
        
         cat_cleanedPhrase = gsub("elderlyer adults", "elderly person", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("wall supports", "walls", cat_cleanedPhrase),
        
         
         cat_cleanedPhrase = gsub("things in the air", "aircrafts", cat_cleanedPhrase),
         
         cat_cleanedPhrase = gsub("places to live", "rentals", cat_cleanedPhrase),
         
         cat_cleanedPhrase = gsub("road widths", "roads", cat_cleanedPhrase),
         
         cat_cleanedPhrase = gsub("booze", "alcoholic drinks", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("holes", "dens", cat_cleanedPhrase),
         
         cat_cleanedPhrase = gsub("flower arrangements", "bouquets", cat_cleanedPhrase),
         
         cat_cleanedPhrase = gsub("entrances", "doorways", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("illunation", np_match, cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("illumination", np_match, cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("entryways", "doorways", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("flower bouquets", "flowers", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("door openings", "doorways", cat_cleanedPhrase),
         
        # cat_cleanedPhrase = gsub("bears den", "bear den", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("computers", "laptop", cat_cleanedPhrase),
         
         cat_cleanedPhrase = gsub("dane", "great dane", cat_cleanedPhrase),
         
        # cat_cleanedPhrase = gsub("places to live", "places", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("podcast", "podcast episode", cat_cleanedPhrase),
        
         cat_cleanedPhrase = ifelse(superordinate == "paints",  gsub("color", "paint", cat_cleanedPhrase), cat_cleanedPhrase),
           
    cat_cleanedPhrase = ifelse(superordinate == "seasons",  gsub("day", "season", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "desserts",  gsub("chocolate", "chocolate fondue", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "times of day",  ifelse(cat_cleanedPhrase == "days", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "statues",  gsub("material", "statues", cat_cleanedPhrase), cat_cleanedPhrase),
  # cat_cleanedPhrase = ifelse(superordinate == "animals",  gsub("animal", "animals", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "insects",  gsub("bug", "insect", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "cookware",  gsub("cook", "cookware", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "buildings",  gsub("apartments", "apartment building", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "venues",  gsub("auditoriums", "concert", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "writing utensils",  gsub("ink", "pen", cat_cleanedPhrase), cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("meals restaurant", "restaurant", cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("episode", np_match, cat_cleanedPhrase),
  
   cat_cleanedPhrase = gsub("bouquet", "flower", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("rain", "rain shower", cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("shower", "rain shower", cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("bodys water", "waterways", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("bodies water", "waterways", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("bouqet", "flower", cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("competition", "race", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("concert music", "concerts", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("condiments", "spices", cat_cleanedPhrase),
  
   cat_cleanedPhrase = gsub("'", "", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("electronics", "electronic devices", cat_cleanedPhrase),
 
   cat_cleanedPhrase = gsub("activities", "places", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("amount", "beer", cat_cleanedPhrase),
   
   
   cat_cleanedPhrase = gsub("bags of trash", "trash can", cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("blade spinning", "helicopter", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("bottles win", "wine", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("brands", np_match, cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("butchershops", np_match, cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "places",  gsub("baths", "sauna", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "alcoholic drinks",  gsub("bottles", "wine", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "furniture",  gsub("cans", "trash cans", cat_cleanedPhrase), cat_cleanedPhrase),
  # cat_cleanedPhrase = ifelse(superordinate == "venues",  gsub("centers", "conference", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "loudness",  gsub("child", "baby", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "weight",  gsub("children", "kid", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("chocolate", "fondue", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("duck", "dusk", cat_cleanedPhrase), cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("cell hone", "phone", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("cites", "city", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("compared store", np_match, cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("cry frinch", "finch", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("cycles", "motorcycle", cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("driving lanes", np_match, cat_cleanedPhrase),
   
   cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("color", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("fur color", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("fur", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("days", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "loudness_n",  gsub("days", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "price",  gsub("days", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "price",  gsub("flats", "apartments", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("evenings", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "speed",  gsub("kid", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "height",  gsub("kid", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "loudness",  gsub("kid", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "strength",  gsub("kid", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "weight",  gsub("kid", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "width",  gsub("lane", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "weight",  gsub("light", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("light", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "height",  gsub("mall", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "speed_f",  gsub("planes", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "height",  gsub("player", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("rinks", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("saturday", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   #cat_cleanedPhrase = ifelse(degree == "loudness_n",  gsub("rinks", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "animals",  gsub("shade", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
  # cat_cleanedPhrase = ifelse(superordinate == "objects",  gsub("wood", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "loudness_n",  gsub("time", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("time", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "speed",  gsub("time", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "price",  gsub("time", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("time", "times of day", cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "price",  gsub("store", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "price",  gsub("shop", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "size",  gsub("store", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "loudness_n",  gsub("store", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "length_duration",  gsub("store", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("sip", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "animals",  gsub("color", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "dogs",  gsub("color", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "cakes",  gsub("color", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "flowers",  gsub("color", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "materials",  gsub("color", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   cat_cleanedPhrase = ifelse(superordinate == "birds",  gsub("color", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("gorilla", "monkey", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("hounds", "bassett hound", cat_cleanedPhrase),
  
   cat_cleanedPhrase = gsub("kids age", "teenager", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("kids walks", "child", cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("mattress", "bedboard", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("neighborhood", "town", cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("pages", "novel", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("water tempertatures", "sauna", cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("trash light", "trash can", cat_cleanedPhrase),
   
   cat_cleanedPhrase = gsub("spa", "sauna", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("skyscrapper", "skyscraper", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("skarks", "shark", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("childern", "kid", cat_cleanedPhrase),
  
   cat_cleanedPhrase = gsub("animal coats", "coats", cat_cleanedPhrase),
   cat_cleanedPhrase = gsub("animal houses openings", "animal houses", cat_cleanedPhrase),
   
         ) %>%
  mutate( cat_cleaned = gsub("_", "", cat_cleanedPhrase),
    specific = containsString_responses(as.character(cat_cleanedPhrase), as.character(np_match), cat_cleaned,  np_match_us), 
         matchingSuper = containsString_responses(as.character(cat_cleanedPhrase), as.character(superordinate), cat_cleaned, super_us)
         ) #%>%
  #filter((specific == 0) & (matchingSuper == 0)) %>% distinct(degree, superordinate, super_us, np, adj, np_match, np_match_us, cleanedPhrase, cat_cleanedPhrase, specific, matchingSuper)
  

d.tidy.resp.analysis.update <- d.tidy.phrase.classified %>% filter((specific == 0) & (matchingSuper == 0))  %>% distinct(degree, superordinate, np, adj, np_match, originalResponse, cleanedPhrase, cat_cleanedPhrase, specific, matchingSuper)
```



``` {r}
# classify superordinate responses
d.unexpected.resps <- d.tidy.phrase.classified %>% filter((specific == 0) & (matchingSuper == 0)) %>% distinct(degree, superordinate, super_us, np, adj, np_match, np_match_us, cleanedPhrase, cat_cleanedPhrase, specific, matchingSuper)

# more responses to be excluded
d.tidy.phrase.classified <- d.tidy.phrase.classified %>% 
subset(., !(cat_cleanedPhrase %in% c("bright", "cliaire", "exacting", "glare", "noisy", "sold expensively") ))


d.tidy.phase.classifiedSuper <- d.tidy.phrase.classified %>%
  mutate(
    cleanedPhrase = cat_cleanedPhrase,
    cleanedPhrase = gsub("pieces of", "", cleanedPhrase),
    cleanedPhrase = gsub("alcohol drinks", "alcoholic drinks", cleanedPhrase),
    cleanedPhrase = gsub("animal houses", "dens", cleanedPhrase),
    cleanedPhrase = gsub("animal noises", "noises", cleanedPhrase),
    cleanedPhrase = gsub("animal sounds", "sounds", cleanedPhrase),
    cleanedPhrase = gsub("aniumals", "animals", cleanedPhrase),
    cleanedPhrase = gsub("apartmets", "apartments", cleanedPhrase),
    cleanedPhrase = ifelse(degree == "speed", gsub("appliances", "cookware", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = gsub("aquarium", "aquariums", cleanedPhrase),
    cleanedPhrase = gsub("athelete", "athlete", cleanedPhrase),
    cleanedPhrase = gsub("bags oftrash", "trash can", cleanedPhrase),
    cleanedPhrase = gsub("baked", "dessert", cleanedPhrase),
    cleanedPhrase = gsub("bank", "banks", cleanedPhrase),
    cleanedPhrase = gsub("barries", "berries", cleanedPhrase),
    cleanedPhrase = gsub("bird cries", "bird sound", cleanedPhrase),
    cleanedPhrase = gsub("bird loud", "bird sound", cleanedPhrase),
    cleanedPhrase = gsub("bodys of water", "waterways", cleanedPhrase),
    cleanedPhrase = gsub("boxes", "box", cleanedPhrase),
    cleanedPhrase = gsub("boxs", "box", cleanedPhrase),
    cleanedPhrase = gsub("bracelts", "bracelets", cleanedPhrase),
    cleanedPhrase = gsub("building", "buildings", cleanedPhrase),
    cleanedPhrase = gsub("chacolate", "chocolate", cleanedPhrase),
    cleanedPhrase = gsub("chocholate", "chocolate", cleanedPhrase),
    cleanedPhrase = gsub("clothes", "cloth", cleanedPhrase),
    cleanedPhrase = gsub("cloths", "cloth", cleanedPhrase),
    cleanedPhrase = gsub("coat of paints", "coat", cleanedPhrase),
    cleanedPhrase = gsub("coat of animals", "coat", cleanedPhrase),
    cleanedPhrase = gsub("coats", "coat", cleanedPhrase),
    cleanedPhrase = gsub("cockpots", "crockpot", cleanedPhrase),
    cleanedPhrase = gsub("craft shop", "crafts", cleanedPhrase),
    cleanedPhrase = gsub("craft supplies", "crafts", cleanedPhrase),
    cleanedPhrase = gsub("compared noise", "noise", cleanedPhrase),
    cleanedPhrase = gsub("creators", "creatures", cleanedPhrase),
    cleanedPhrase = gsub("cry of finch", "finch", cleanedPhrase),
    cleanedPhrase = gsub("crying", "cries", cleanedPhrase),
    cleanedPhrase = gsub("days", "day", cleanedPhrase),
    cleanedPhrase = gsub("dinners", "dinner", cleanedPhrase),
    cleanedPhrase = gsub("distances", "distance", cleanedPhrase),
    cleanedPhrase = gsub("documentry", "documentary", cleanedPhrase),
    cleanedPhrase = gsub("dog hair", "dog coats", cleanedPhrase),
    cleanedPhrase = gsub("door of house", "doors house", cleanedPhrase),
    cleanedPhrase = gsub("drink choices", "drinks", cleanedPhrase),
    cleanedPhrase = gsub("environment quiet", "environment", cleanedPhrase),
    cleanedPhrase = gsub("environments", "environment", cleanedPhrase),
    cleanedPhrase = gsub("fabrics", "fabric", cleanedPhrase),
    cleanedPhrase = gsub("floor types", "floors", cleanedPhrase),
    cleanedPhrase = gsub("floor styles", "floors", cleanedPhrase),
    cleanedPhrase = gsub("flyers", "aircrafts", cleanedPhrase),
    
    cleanedPhrase = gsub("flying", "aircrafts", cleanedPhrase),
    cleanedPhrase = gsub("food items", "food", cleanedPhrase),
    cleanedPhrase = gsub("food products", "food", cleanedPhrase),
    cleanedPhrase = gsub("food expensive", "food", cleanedPhrase),
    cleanedPhrase = gsub("food served", "food", cleanedPhrase),
    cleanedPhrase = gsub("foods", "food", cleanedPhrase),
    cleanedPhrase = gsub("forest paths", "forest", cleanedPhrase),
    cleanedPhrase = gsub("forest sounds", "sounds", cleanedPhrase),
    cleanedPhrase = gsub("forests", "forest", cleanedPhrase),
    cleanedPhrase = gsub("forms of transportation", "transportation", cleanedPhrase),
    cleanedPhrase = gsub("fowers", "flowers", cleanedPhrase),
    cleanedPhrase = gsub("fruits", "fruit", cleanedPhrase),
    cleanedPhrase = gsub("furniture narrow door of house", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("furniture of type", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("furniture pieces", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("furniture sizes", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("furnitures", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("gutiars", "guitars", cleanedPhrase),
    cleanedPhrase = gsub("hardware store", "cotton", cleanedPhrase),
    cleanedPhrase = gsub("highways", "highway", cleanedPhrase),
    cleanedPhrase = gsub("homes", "house", cleanedPhrase),
    cleanedPhrase = gsub("houses", "house", cleanedPhrase),
    cleanedPhrase = gsub("housing", "rental", cleanedPhrase),
    cleanedPhrase = gsub("insect terrarium", "insects", cleanedPhrase),
    cleanedPhrase = gsub("instruments heard", "instruments", cleanedPhrase),
    cleanedPhrase = gsub("instruments played", "instruments", cleanedPhrase),
    cleanedPhrase = gsub("instuments", "instruments", cleanedPhrase),
    cleanedPhrase = gsub("items bought", "items", cleanedPhrase),
    cleanedPhrase = gsub("items ground", "items", cleanedPhrase),
    cleanedPhrase = gsub("items hardware store", "items", cleanedPhrase),
    cleanedPhrase = gsub("items kitchen", "items", cleanedPhrase),
    cleanedPhrase = gsub("items pick up", "items", cleanedPhrase),
    cleanedPhrase = gsub("items store", "items", cleanedPhrase),
    cleanedPhrase = gsub("jewelery", "jewelry", cleanedPhrase),
    cleanedPhrase = gsub("jewelery", "jewelry", cleanedPhrase),
    cleanedPhrase = gsub("kids age", "kid", cleanedPhrase),
    cleanedPhrase = gsub("kitchens", "kitchen", cleanedPhrase),
    cleanedPhrase = gsub("kitchenware", "cookware", cleanedPhrase),
    cleanedPhrase = gsub("lakes", "lake", cleanedPhrase),
    cleanedPhrase = gsub("levels of sound", "sound", cleanedPhrase),
    cleanedPhrase = gsub("libraries", "library", cleanedPhrase),
    cleanedPhrase = gsub("loud machines", "machines", cleanedPhrase),
    cleanedPhrase = gsub("machinery", "machines", cleanedPhrase),
    cleanedPhrase = gsub("meals resataurants", "restaurants", cleanedPhrase),
    cleanedPhrase = gsub("market foods", "food", cleanedPhrase),
    cleanedPhrase = gsub("market", np_match, cleanedPhrase),
    cleanedPhrase = gsub("previous cars", "cars", cleanedPhrase),
    cleanedPhrase = gsub("sea creatures", "sealife", cleanedPhrase),
    cleanedPhrase = gsub("marine life", "sealife", cleanedPhrase),
    cleanedPhrase = gsub("desswerts", "desserts", cleanedPhrase),
    cleanedPhrase = gsub("means of transportation", "transportation", cleanedPhrase),
    cleanedPhrase = gsub("meeting hall", "venues", cleanedPhrase),
    cleanedPhrase = gsub("meeting rooms", "venues", cleanedPhrase),
    cleanedPhrase = gsub("menus", "menu", cleanedPhrase),
    cleanedPhrase = gsub("metal bracelet", "bracelets", cleanedPhrase),
    cleanedPhrase = gsub("metals", "metal", cleanedPhrase),
    cleanedPhrase = gsub("methods of transportation", "transportation", cleanedPhrase),
    cleanedPhrase = gsub("move furniture", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("movies", "movie", cleanedPhrase),
    cleanedPhrase = gsub("music sounds", "music", cleanedPhrase),
    cleanedPhrase = gsub("music instrument", "muical instruments", cleanedPhrase),
    cleanedPhrase = gsub("noises", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise area", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise forest night", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise hears", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise lake", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise park", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise  nearby", "noise", cleanedPhrase),
    cleanedPhrase = gsub("object kitchen", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects house", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects kitchen", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects lift", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects lifted", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects sitting", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects store", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects terrarium", "objects", cleanedPhrase),
    cleanedPhrase = gsub("ofart", "art", cleanedPhrase),
    cleanedPhrase = gsub("offorest", "forest", cleanedPhrase),
    cleanedPhrase = gsub("oftravel", "travel", cleanedPhrase),
    cleanedPhrase = gsub("ofspace", "space", cleanedPhrase),
    cleanedPhrase = gsub("of walking", "walks", cleanedPhrase),
    cleanedPhrase = gsub("ofkitchen", "kitchen", cleanedPhrase),
    cleanedPhrase = gsub("openings earth", "openings", cleanedPhrase),
    cleanedPhrase = gsub("objects house", "objects", cleanedPhrase),
    cleanedPhrase = gsub("papers writing scripts", "scripts", cleanedPhrase),
    cleanedPhrase = gsub("parks", "park", cleanedPhrase),
    cleanedPhrase = gsub("pathways", "paths", cleanedPhrase),
    cleanedPhrase = gsub("people lifting weights", "people", cleanedPhrase),
    cleanedPhrase = gsub("person", "people", cleanedPhrase),
    cleanedPhrase = gsub("peunguins", "penguin", cleanedPhrase),
    cleanedPhrase = gsub("playing", np_match, cleanedPhrase),
    cleanedPhrase = gsub("prices", "price", cleanedPhrase),
    cleanedPhrase = gsub("properties", "rentals", cleanedPhrase),
    cleanedPhrase = gsub("race distance", "races", cleanedPhrase),
    cleanedPhrase = gsub("raspberriees", "raspberries", cleanedPhrase),
    cleanedPhrase = gsub("real estate", "rentals", cleanedPhrase),
    cleanedPhrase = gsub("restaraunts", "restaurants", cleanedPhrase),
    cleanedPhrase = gsub("restaraunt prices", "restaurants", cleanedPhrase),
    
    cleanedPhrase = gsub("rooms building venue", "venues", cleanedPhrase),
    cleanedPhrase = gsub("rooms house", "rooms", cleanedPhrase),
    cleanedPhrase = gsub("run fast", "runners", cleanedPhrase),
    cleanedPhrase = gsub("satues", "statues", cleanedPhrase),
    cleanedPhrase = gsub("saturday nights", np_match, cleanedPhrase),
    cleanedPhrase = gsub("script writings", "script", cleanedPhrase),
    cleanedPhrase = gsub("scripts", "script", cleanedPhrase),
    cleanedPhrase = gsub("seacreatures", "sealife", cleanedPhrase),
    cleanedPhrase = gsub("selling price", "price", cleanedPhrase),
    cleanedPhrase = gsub("shades stronger characteristic", "wall", cleanedPhrase),
    cleanedPhrase = gsub("shopping centers", "mall", cleanedPhrase),
    cleanedPhrase = gsub("shopping", "mall", cleanedPhrase),
    cleanedPhrase = gsub("snack foods", "snacks", cleanedPhrase),
    cleanedPhrase = gsub("sofas", "couch", cleanedPhrase),
    cleanedPhrase = gsub("satues", "statues", cleanedPhrase),
    cleanedPhrase = gsub("songs played", "songs", cleanedPhrase),
    cleanedPhrase = gsub("sounds forest", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds area", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds lake", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds moment", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds nearby", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds park", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds vicinity", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds", "sound", cleanedPhrase),
    cleanedPhrase = gsub("spa services", "sauna", cleanedPhrase),
    cleanedPhrase = gsub("sounds area", "sounds", cleanedPhrase),
    cleanedPhrase = gsub("spirinting race", "sprint", cleanedPhrase),
    cleanedPhrase = gsub("statutes", "statues", cleanedPhrase),
    cleanedPhrase = gsub("stringed instruments", "string instruments", cleanedPhrase),
    cleanedPhrase = gsub("surfaces sit", "surfaces", cleanedPhrase),
    cleanedPhrase = gsub("terrarium's", "terrariums", cleanedPhrase),
    cleanedPhrase = gsub("thundersorms", "thunderstorm", cleanedPhrase),
    cleanedPhrase = gsub("transportation methods", "transportation", cleanedPhrase),
    cleanedPhrase = gsub("types of music", "music", cleanedPhrase),
    cleanedPhrase = ifelse(superordinate == "places", sub("venues", "places", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = gsub("water color", "watercolor", cleanedPhrase),
    cleanedPhrase = gsub("watercoolers", "watercolor", cleanedPhrase),
    cleanedPhrase = gsub("weather cold", "weather", cleanedPhrase),
    cleanedPhrase = gsub("weather events", "weather", cleanedPhrase),
    cleanedPhrase = gsub("weather conditions", "weather", cleanedPhrase),
    cleanedPhrase = gsub("weather patterns", "weather", cleanedPhrase),
    cleanedPhrase = gsub("weight lifter", "weightlifter", cleanedPhrase),
    cleanedPhrase = gsub("wooffloor", "wood", cleanedPhrase),
    cleanedPhrase = gsub("furnature", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("alochols", "alcoholic drinks", cleanedPhrase),
    cleanedPhrase = gsub("coat of animals", "animal coat", cleanedPhrase),
         ) %>%
  mutate( cat_cleaned = gsub("_", "", cleanedPhrase),
    specific = containsString_responses(as.character(cleanedPhrase), as.character(np_match), cat_cleaned,  np_match_us), 
         matchingSuper = containsString_responses(as.character(cleanedPhrase), as.character(superordinate), cat_cleaned, super_us)
         )

d.tidy.phase.classifiedSuper %>% filter((specific == 0) & (matchingSuper == 0)) %>% distinct(degree, superordinate, super_us, np, adj, np_match, np_match_us, originalResponse, cleanedPhrase, cat_cleaned, specific, matchingSuper) %>% View()
```



Coat of paint,
scripts,
animal

owl --> parts of the forest. Participant inferred different referent for "it"... they thought it meant physical place. Part of the subtlety of the task...

cyclist --> "muscles" (nonsense)

frying pan --> "other dinners" (like owl, different referent... here the food.)

fabric . superordinate



```{r}
d.tidy.phrase.specificMarking.bs <- d.tidy.phase.classifiedSuper %>% 
  filter(!((specific == 0) & (matchingSuper == 0)))  %>% 
  #mutate() %>%
  group_by(np_expectations, adj_polarity) %>%
  tidyboot_mean(column = specific)

d.tidy.phrase.specificMarking.bs.item <- d.tidy.phase.classifiedSuper %>%
  filter(!((specific == 0) & (matchingSuper == 0)))  %>% 
  mutate() %>%
  group_by( stim_id, degree, superordinate, np_expectations,  np, adj_polarity) %>%
  tidyboot_mean(column = specific)

d.tidy.phrase.specificMarking.bs %>%
  ungroup() %>%
  mutate(np_expectations = gsub('\"', "", np_expectations),
         adj_polarity = gsub('\"', "", adj_polarity),
         np_expectations = factor(np_expectations,
                               levels = c("low", "medium", "high"))
) %>%
  ggplot(., 
       aes( x = np_expectations, y = mean, 
            ymin = ci_lower, ymax = ci_upper, fill = adj_polarity))+  
  geom_col(position = position_dodge(0.8), width = 0.8, alpha = 0.6, color = 'black', size = 1)+

  geom_point(position = position_jitterdodge(jitter.width = 0.2, jitter.height = 0), 
             data = d.tidy.phrase.specificMarking.bs.item,
             aes( y = mean, fill = adj_polarity, x = np_expectations),
             shape = 21, alpha = 0.8)+
  geom_linerange(position = position_dodge(0.8), color = 'black', size = 1)+
  scale_fill_brewer(palette = "Set3")+
  theme(#axis.text.x = element_text(angle = 45, hjust = 1.0, vjust = 1),
        #axis.title.x = element_blank(),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.line = element_line(colour = "black"))+
 # theme_black()+
  scale_y_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1))+
  ylab("Proportion paraphrases that contain Specific NP")+
  xlab("Subordinate Category General Expectations")

 ggsave(filename = "../writing/paper/figs/bars_cc_finalExpt_prereg_bars.pdf",
        width = 6, height = 4)
```

By-item plot


```{r figIndivItems}

d.tidy.phrase.specificMarking.bs.item %>%
   ungroup() %>%
   mutate(np_expectations = gsub('\"', "", np_expectations),
          adj_polarity = gsub('\"', "", adj_polarity),
          np_expectations = factor(np_expectations,
                                   levels = c("low", "medium", "high")),
          np = fct_reorder(np, as.numeric(np_expectations)),
          item_set = paste(degree, " - ", superordinate, "-", stim_id, sep = "")) %>%
   ggplot(., 
          aes( x = np, y = mean, 
               ymin = ci_lower, ymax = ci_upper, fill = adj_polarity))+  
   geom_col(position = position_dodge(0.8), width = 0.8, alpha = 0.7, color = 'black')+
   geom_linerange(position = position_dodge(0.8), color = 'black')+  
   scale_fill_brewer(palette = "Set3")+
   theme(axis.text.x = element_text(angle = 45, hjust = 1.0, vjust = 1),
         #axis.title.x = element_blank(),
         panel.grid.minor = element_blank(),
         panel.grid.major = element_blank(),
         axis.line = element_line(colour = "black"))+
   facet_wrap(~item_set, scales = 'free')+
   # theme_black()+
   scale_y_continuous(limits = c(-0.02, 1.02), breaks = c(0, 0.5, 1))+
   ylab("Proportion paraphrases that contain NP")+
   xlab("Subordinate Category Prior Mean") -> bars_cc_finalExpt_prereg_prelim_byItem

 # ggsave("../analysis/figs/bars_cc_finalExpt_pilot_byItem.png",
 #        width = 9, height = 9)
 ggsave(bars_cc_finalExpt_prereg_prelim_byItem, 
        filename = "../writing/paper/figs/bars_cc_finalExpt_prereg_prelim_byItem3.png",
        width = 18, height = 18)
```


## Look at items with n>=35

```{r}

d.item.n35 <- d.item.count %>%
  filter(n >= 35) %>%
  mutate(unique_id = paste(stim_id, np_expectations, adj_polarity, sep = "_")) %>%
  pull(unique_id)


d.item.n35.bs <- d.tidy.phrase.w.original %>%
  mutate(unique_id = paste(stim_id, np_expectations, adj_polarity, sep = "_")) %>%
  filter(unique_id %in% d.item.n35) %>%
  group_by(stim_id, np_expectations, adj_polarity) %>%
  summarize(n_sum = sum(specific), n = n())
```




The data points are grouped by NP, specificity and scale condition and the number of occurances of each response is calculated. The most common responses (both subordinate and superordinate) will be used for the adjective endorsement task. 
``` {r}

# np_for_match includes just the key words to match the specific reponses, whereas np_for_freq has the full np for which the frequency was searched such that the frequency can be matched 
# the superordinate for the NPs where the modal responses did not match the anticipated one are substituted to the modal participant response 

# extract the mode response 
d.tidy.resp.counts <- d.tidy.phase.classifiedSuper %>% 
  group_by(degree, superordinate, np_match, specific, adj, cleanedPhrase) %>% count() %>% 
  mutate(n_unique_resps = n)

# insert the mode NP (modal subordinate where participants gave subordinate response, modal superordinate where they gave superordinate response)
# in column mode
d.tidy.resp.counts <- d.tidy.resp.counts %>% group_by(superordinate, np_match, specific) %>% mutate(mode = cleanedPhrase[which.max(n)]
                                                                                     )



# analysis of modal responses
d.tidy.resp.counts.analysis <- d.tidy.resp.counts %>% rowwise() %>%  
  mutate(isModeNP = containsString(as.character(mode), as.character(np_match)),
        isModeSuper = containsString(as.character(mode), as.character(superordinate)),
        isModeNeither = sum(isModeNP, isModeSuper),
        mode = gsub("_", "", mode)) # isModeNeither = 0 means that the mode response is different from anticipated NPs
d.tidy.resp.counts.analysis %>% filter(isModeNeither == 0) %>% distinct(degree, superordinate, np_match, specific, adj, mode)

non.matching.mode.resps <- d.tidy.resp.counts.web %>% filter(isModeNeither == 0) %>% 
  mutate(mode = gsub("_", "", mode))# %>% select(degree, superordinate, np_match, specific, np_positiveness, adj, adj_positiveness, n_unique_resps, mode) %>% distinct()
#%>% write_csv(., '../data/pilot-classElicitation-free-4/class-elicitation-free-4-nonmatching-mode-resps.csv')

# the data is adjusted to the human modal responses in the following chunks
```

``` {r}

# plural noun phrases are adjusted to the frequency queries 
d.tidy.phrase.w.original.mode.pl <- d.tidy.phrase.w.original %>% subset(., !(np_pl %in% c("days", "dusks", "nights"))) %>%
  mutate(np_for_freq = np_pl,
        np_for_freq = gsub("carpets", "carpet floors", np_for_freq),
        np_for_freq = gsub("tiles", "tile floors", np_for_freq),
        np_for_freq = gsub("wood", "wood floors", np_for_freq),
        np_for_freq = gsub("winter", "winter days", np_for_freq),
        np_for_freq = gsub("fall", "fall days", np_for_freq),
        np_for_freq = gsub("summer", "summer days", np_for_freq),
        np_for_freq = gsub("plastic", "plastic statues", np_for_freq),
        np_for_freq = gsub("bronze", "bronze statues", np_for_freq),
        np_for_freq = gsub("platinum", "platinum statue", np_for_freq),
        np_for_freq = gsub("pieces of chocolate", "chocolates", np_for_freq),
        
        # substitutions made based on human modal responses 
        superordinate = ifelse(np_for_freq == "golfers", "people", superordinate),
        superordinate = ifelse(np_for_freq == "jockeys", "people", superordinate),
        superordinate = ifelse(np_for_freq == "basketball players", "people", superordinate),
        superordinate = ifelse(np_for_freq == "walkers", "people", superordinate),
        superordinate = ifelse(np_for_freq == "runners", "people", superordinate),
        superordinate = ifelse(np_for_freq == "joggers", "people", superordinate),
        superordinate = gsub("holes", "burrows",  superordinate)
         ) %>% 
  # if the response is specific (subordinate), the modal NP is inserted, otherwise the modal superordinate is inserted 
  mutate(mode_np = ifelse(specific == 1, np_for_freq, superordinate))
# this data can be fed into python frequency extractor, frequencies to be extracted are unique mode_np's and superordinates

d.tidy.phrase.w.original.mode.pl <- d.tidy.phrase.w.original.mode.pl %>%
  left_join(., df.frequencies, by = c("np_for_freq" ="Nps")) %>% # add subordinate frequencies
  left_join(., df.frequencies, by=c("superordinate"="Nps"))   # add superordinate frequencies

df.mode.final <- d.tidy.phrase.w.original.mode.pl %>% select(workerid, degree, superordinate_sg, superordinate, adj, adj_positiveness, np, np_for_freq, mode_np, specific, Frequencies.x.x, Frequencies.y.y) %>% mutate(superordinate_sg = superordinate_sg, superordinate_pl = superordinate, NP_sg = np, NP_pl = np_for_freq,  response = mode_np, subFreq = Frequencies.x.x, superFreq = Frequencies.y.y) %>% select(workerid, degree, superordinate_sg, superordinate_pl, adj, adj_positiveness, NP_sg, NP_pl, response, specific, subFreq, superFreq)

# check if singular matches original
df.sg <- read_csv('../data/pilot-classElicitation-free-4/class-elicitation-free-4-cleaned-data-w-sub2.csv')
anti_join(df.mode.final, df.sg, by = c("specific" = "specific")) %>% View()


write_csv(df.mode.final, '../data/pilot-classElicitation-free-4/class-elicitation-free-4-cleaned-data-SG-PL-update.csv')
```


``` {r}
#substitution of superordinates based on human data for singular NPs
d.tidy.phrase.w.original.mode <- d.tidy.phrase.w.original %>% mutate(superordinate = 
                                                                       ifelse(np_match == "golfer", "people", superordinate),
                                                                     superordinate = 
                                                                       ifelse(np_match == "jockey", "people", superordinate),
                                                                     superordinate = 
                                                                       ifelse(np_match == "basketball", "people", superordinate),
                                                                  #   superordinate = 
                                                                   #    ifelse(np_match == "plastic", "decorations", superordinate),
                                                                     superordinate = 
                                                                       ifelse(np_match == "walker", "people", superordinate),
                                                                      superordinate = 
                                                                       ifelse(np_match == "jogger", "people", superordinate),
                                                                      superordinate = 
                                                                       ifelse(np_match == "runner", "people", superordinate))
                                                                  #   superordinate = 
                                                                   #    ifelse(np_match == "downtown street", "street", superordinate),
                                                                #     superordinate = 
                                                                 #      ifelse(np_match == "dusk", "days", superordinate))

```

``` {r}
# exploration of prior estimation by frequency
df.plural <- d.tidy.resp.counts.pl %>% select(degree, superordinate, specific, mode_np, Frequencies.x, Frequencies.y) %>% distinct() %>% rowwise() %>%
# beta = 0.1
  mutate(
    exp_ratio = exp(0.1*log(Frequencies.x))/exp(0.1*log(Frequencies.y)),
    exp_ratio_sum = exp(0.1*log(Frequencies.x))/(exp(0.1*log(Frequencies.y)) + exp(0.1*log(Frequencies.x))),
    #log_ratio = exp( 0.1*log(Frequencies.x/Frequencies.y) ),
   # beta_log_ratio = exp( 0.1 * log(Frequencies.x)/log(Frequencies.y) ),
    #exp_log_ratio = exp( 0.1 * log(Frequencies.x)/0.1*log(Frequencies.y) )
    #mean_mh = (0.1*log(Frequencies.x))/( (0.1*log(Frequencies.x)) + (0.1*log(Frequencies.y)))
    ) %>% 
  group_by(degree, superordinate) %>%
  summarize( mean_exp_ratio = mean(exp_ratio),
             mean_exp_sum = mean(exp_ratio_sum) 
             #   mean_log_ratio = mean(log_ratio),
         #    mean_beta_log_ratio = mean(beta_log_ratio),
         #    mean_exp_log_ratio = mean(exp_log_ratio)
             )# %>% View()

        
my.degrees <- c("size", "height", "price", "length_duration", "speed", "size", "width", "weight", "price", "weight", "width", "height", "hardness", "hardness", "temperature", "strength", "loudness", "strength", "darkness", "length_duration", "loudness", "temperature", "speed")
my.super <- c("plants", "animals", "statues", "readings", "people", "animals", "burrows", "people", "alcoholic drinks", "animals", "roads", "people", "floors", "sweets", "food", "people", "rooms", "storms", "birds", "dogs", "animals", "seasons", "animals")
est.cc <- c(0.931, 0.857, 0.151, 0.805, 0.722, 0.792, 0.728, 0.762, 0.887, 0.671, 0.248, 0.627, 0.396, 0.592, 0.673, 0.612, 0.389, 0.654, 0.620, 0.273, 0.578, 0.520, 0.446)
df.mh <- tibble(my.degrees, my.super, est.cc)
df.joint <- df.plural %>% left_join(., df.mh, by=c("superordinate"="my.super", "degree" ="my.degrees")) 
df.joint <- df.joint  %>% mutate(sqErr = round( ((est.cc - mean_exp_ratio)^2) , 5),
                                 sqErrSum = round( ((est.cc - mean_exp_sum)^2), 5) )
#write_csv(df.joint, "../data/pilot-classElicitation-free-4/class-elicitation-model-empirical-sub-priors.csv")
```


``` {r}
# substitute mode responses with typos or not mathcing equivalent seed NPs
d.tidy.resp.counts.web <- d.tidy.resp.counts.web %>% rowwise() %>% mutate(cleanMode = gsub("_", "", mode),
                                                                 cleanMode = gsub("baby", "babies", cleanMode),
                                                                 cleanMode = gsub("days fall", "days in fall",
                                                                                 cleanMode),
                                                                 cleanMode = gsub("ice cream", "ice creams",
                                                                                 cleanMode),
                                                                 cleanMode = gsub("times day", "times of day",
                                                                                  cleanMode),
                                                                 cleanMode = gsub("story", "stories", cleanMode),
                                                                 cleanMode = gsub("bottles wine", 
                                                                                  "bottles of wine", cleanMode),
                                                                 cleanMode = gsub("mouse", "mice", cleanMode),
                                                                 cleanMode = gsub("cheetahhs", "cheetahs",
                                                                                  cleanMode),
                                                                 cleanMode = gsub("days fall", "fall days",
                                                                                  cleanMode),
                                                                 cleanMode = gsub("teenageragers", "teenagers", cleanMode)
                                                                 )

#write_csv(d.tidy.resp.counts, '../data/pilot-classElicitation-free-4/class-elicitation-free-4-modal-responses.csv')
```


# Viz: First prass

```{r figCollapseItems}
d.tidy.phrase.specificMarking.bs <- d.tidy.phrase.w.original %>% 
  mutate() %>%
  group_by(np_positiveness,  adj_positiveness) %>%
  tidyboot_mean(column = specific)

d.tidy.phrase.specificMarking.bs %>%
  ungroup() %>%
  mutate(np_positiveness = gsub('\"', "", np_positiveness),
         adj_positiveness = gsub('\"', "", adj_positiveness),
         np_positiveness = factor(np_positiveness,
                               levels = c("negative", "neither-nor", "positive"),
                               labels = c("low", "medium", "high")
)) %>%
  rename(adj_polarity = adj_positiveness) %>%
  ggplot(., 
       aes( x = np_positiveness, y = mean, 
            ymin = ci_lower, ymax = ci_upper, fill = adj_polarity))+  
  geom_col(position = position_dodge(0.8), width = 0.8, alpha = 0.7, color = 'black')+
  geom_linerange(position = position_dodge(0.8), color = 'black')+  
  scale_fill_brewer(palette = "Set3")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1.0, vjust = 1),
        #axis.title.x = element_blank(),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.line = element_line(colour = "black"))+
 # theme_black()+
  scale_y_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1))+
  ylab("Proportion paraphrases that contain NP")+
  xlab("Subordinate Category Prior Mean")

# ggsave("../analysis/figs/bars_cc_finalExpt_pilot.png",
#        width = 5, height = 3.6)
```


# by item


add superordinate labels
```{r}
df.adj <- read_csv("../data/pilot-adj-endorsement-1/pilot-adj-endorsement-1-trials.csv")

df.adj %>% 
  distinct(item, superordinate) -> df.super
```


# Regression modeling


### Simulate data to get contrast coding right

```{r}
simulated.data <- bind_rows(
  data.frame(
    np = "mid",
    adj = "short",
    x = rnorm(n = 20, mean = 1, sd = 0.5)
  ),
  data.frame(
    np = "mid",
    adj = "tall",
    x = rnorm(n = 20, mean = 1, sd = 0.5)
  ), 
  data.frame(
    np = "low",
    adj = "short",
    x = rnorm(n = 20, mean = 0.5, sd = 0.5)
  ),
  data.frame(
    np = "low",
    adj = "tall",
    x = rnorm(n = 20, mean = 1.5, sd = 0.5)
  ), 
  data.frame(
    np = "high",
    adj = "short",
    x = rnorm(n = 20, mean = 1.5, sd = 0.5)
  ),
  data.frame(
    np = "high",
    adj = "tall",
    x = rnorm(n = 20, mean = 0.5, sd = 0.5)
  )
) %>%
  mutate(np = factor(np, levels = c("mid", "low", "high")),
         adj = factor(adj, levels = c("short", "tall")))

simulated.data.means <- simulated.data %>%
  group_by(np, adj) %>%
  summarize(m = mean(x)) 

simulated.data.means %>%
  ggplot(., aes (x = np, y = m, fill = adj))+
  geom_col(position = position_dodge())


contrasts(simulated.data$adj) <- c(-0.5, 0.5)

contrasts(simulated.data$np) 

lm.sim<- lm(x ~ np*adj, data = simulated.data)

lm.sim.summ <- summary(lm.sim)

sim.int <- lm.sim.summ$coefficients[["(Intercept)", "Estimate"]]
sim.beta_adj <- lm.sim.summ$coefficients[["adj1", "Estimate"]]
sim.beta_npLow <- lm.sim.summ$coefficients[["nplow", "Estimate"]]
sim.beta_npHigh <- lm.sim.summ$coefficients[["nphigh", "Estimate"]]
sim.beta_npLow_adj <- lm.sim.summ$coefficients[["nplow:adj1", "Estimate"]]
sim.beta_npHigh_adj <- lm.sim.summ$coefficients[["nphigh:adj1", "Estimate"]]

print(
  paste(
    "actual mean of MID tall" ,  
    simulated.data.means %>% filter(np == "mid", adj == "tall") %>% pull(m),
    "model prediction", 
    sim.int + 0.5 * sim.beta_adj
  )
)

print(
  paste(
    "actual mean of MID short" ,  
    simulated.data.means %>% filter(np == "mid", adj == "short") %>% pull(m),
    "model prediction", 
    sim.int - 0.5 * sim.beta_adj
  )
)

print(
  paste(
    "actual mean of HIGH tall" ,  
    simulated.data.means %>% filter(np == "high", adj == "tall") %>% pull(m),
    "model prediction", 
    sim.int + 0.5 * sim.beta_adj + sim.beta_npHigh + 0.5 * sim.beta_npHigh_adj
  )
)

print(
  paste(
    "actual mean of HIGH short" ,  
    simulated.data.means %>% filter(np == "high", adj == "short") %>% pull(m),
    "model prediction", 
    sim.int - 0.5 * sim.beta_adj + sim.beta_npHigh - 0.5 * sim.beta_npHigh_adj
  )
)

print(
  paste(
    "actual mean of LOW tall" ,  
    simulated.data.means %>% filter(np == "low", adj == "tall") %>% pull(m),
    "model prediction", 
    sim.int + 0.5 * sim.beta_adj + sim.beta_npLow + 0.5 * sim.beta_npLow_adj
  )
)

print(
  paste(
    "actual mean of LOW short" ,  
    simulated.data.means %>% filter(np == "low", adj == "short") %>% pull(m),
    "model prediction", 
    sim.int - 0.5 * sim.beta_adj + sim.beta_npLow - 0.5 * sim.beta_npLow_adj
  )
)
```


```{r}
d.tidy.phrase.w.original.fac <- d.tidy.phrase.w.original %>%
  mutate(adj_positiveness = factor(adj_positiveness, 
                                   levels = c("negative", "positive")),
         np_positiveness = factor(np_positiveness, 
                                  levels = c("neither-nor", "negative", "positive"))) %>%
  rowwise() %>%
  mutate(item_set = paste(degree, "_", superordinate, sep = "")) %>%
  ungroup() %>%
  mutate(item_set = factor(item_set),
         workerid = factor(workerid))



contrasts(d.tidy.phrase.w.original.fac$adj_positiveness) <- c(-1/2, 1/2)

rs.glm.brm <- brm(
  formula = specific ~ np_positiveness * adj_positiveness + 
    (1 +  np_positiveness*adj_positiveness | workerid) + 
    (1 +  np_positiveness*adj_positiveness | item_set),
  family = bernoulli(), chains = 3, cores = 3, iter = 1000,
  data = d.tidy.phrase.w.original.fac)


rs.glm.brm.summary <- summary(rs.glm.brm)

rs.glm.brm.summary

```

```{r}
write_csv(data.frame(rs.glm.brm.summary[["fixed"]]) %>% 
            mutate(Rowname = row.names(.)), 
          path = "../writing/paper/csv_data_4_tex/expt3_brm_pilot.csv")
```

```{r}
rs.glm <- glmer(
  formula = specific ~ np_positiveness * adj_positiveness + 
    (1 | workerid) + 
    (1 | superordinate),
  family = 'binomial', 
  data = d.tidy.phrase.w.original.fac)

contrasts(d.tidy.phrase.w.original.fac$np_positiveness)

summary(rs.glm)
```

```{r pluralNP}

# insert plural noun phrases additionally to recorded seed NPs in order to use plural frequencies 
# THE ORIGINAL NPs ARE USED, NOT THE SUBSTITUTED ONES
insert_plural_np = function(np) {
  if (np %in% c("seagull", "parrot", "crow", "day", "dusk", "night", "jolly rancher", "marshmallow",
               "tile", "carpet", "giraffe", "monkey", "bird", "donkey", "dog", "cat", "elephant", "cheetah",
               "sloth","basketball player", "golfer", "jockey", "runner", "jogger", "walker", "dachshund",
               "bassett hound", "chihuahua", "novel", "poem", "classroom", "study hall", "tree", "flower",
               "adult", "teenager",  "kid", "hurricane", "thunderstorm", "rain", "soup", "salad",
               "cave", "cavern", "fox hole", "highway", "side road", "downtown street"))  {
    np_pl = paste(np, "s", sep="")
  } else if (np %in% c("piece of chocolate" )) {
    np_pl = "pieces of chocolate"
  } else if (np %in% c( "fish", "wood", "platinum", "bronze", "plastic",  "ice cream", 
                       "summer", "fall", "winter" )) {
    np_pl = np
  } else if( np %in% c("story")) {
    np_pl = "stories"
  } else if( np %in% c("mouse")) {
    np_pl = "mice"
  } else if( np %in% c("auditorium")) {
    np_pl = "auditoria"
  } else if (np %in% c("bottle of top-shelf liquor")) {
    np_pl = "liquors"
  } else if (np %in% c("six-pack of beer")) {
    np_pl = "beers"
  } else if (np %in% c( "bottle of wine")) {
    np_pl = "bottles of wine"
  } else if (np %in% c( "bush" )) {
    np_pl = "bushes"
  } else if(np %in% c( "child")) {
    np_pl = "children"
  } else if (np %in% c("baby")) {
    np_pl = "babies"
  } else {
    np_pl = np
  }
  return (np_pl)
}

df.trials.w.super <- df.trials.w.super %>% 
  rowwise() %>% 
  mutate(np_pl = insert_plural_np(np))

```

