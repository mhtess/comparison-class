---
title: "Comparison class elicitation (final) pilot"
author: "MH Tessler"
date: "October 29, 2019"
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Load libraries.
library(knitr)
library(tidyverse)
library(jsonlite)
library(tidyboot)
library(tidytext)
library(lme4)
library(ggthemes)
library(brms)
library(stringr)
theme_set(theme_few())

# extended function to check matching between strings either way 
containsString_responses <- function(strng, substrng, clean_str, us_substr){
  return(ifelse(length(strsplit(strng, substrng)[[1]]) > 1, 1, 
                ifelse( length(strsplit(us_substr, clean_str)[[1]]) > 1, 1, 0)))
}
containsString <- function(strng, substrng){
  return(ifelse(length(strsplit(strng, substrng)[[1]]) > 1, 1, 
                ifelse( length(strsplit(substrng, strng)[[1]]) > 1, 1, 0)))
}

my_stop_words <- stop_words %>% rowwise() %>%
    subset(!(stop_words$word %in% c("rooms", "year", "years", "side", "sides", "area",
                                    "of", "up", "great", "things", "places", "thing",
                                    "room", "areas", "part", "parts", "works", "way", "ways",
                                    "-", "show", "shows", "goods", "novel", "back")))

```

### Load data


```{r load data from json, eval = F}
data.path <- "../mturk/class-elicitation-prereg-final/production-results/"
result.files <- list.files(data.path, pattern="json")

df.subject <- data.frame()
df.trials <- data.frame()
df.attention <- data.frame()
for (result_file in result.files) {
  result_json = fromJSON(paste(data.path, result_file, sep ="/"))
  worker.id = paste("workerid_", str_pad(match(result_file, result.files), 4, pad="0"), sep = "")
#  result_json$WorkerId
  condition = result_json$answers$condition
  
  df.attention = bind_rows(
    df.attention, 
    data.frame(result_json$answers$catch_trials) %>%
      mutate(workerid = worker.id)
  )
    
  df.subject = bind_rows(
    df.subject, 
    data.frame(result_json$answers$subject_information) %>% 
      mutate(
        workerid = worker.id,
        language = gsub("\"", "", language),
        enjoyment = gsub("\"", "", enjoyment),
        age = gsub("\"", "", age),
        gender = gsub("\"", "", gender),
        problems = gsub("\"", "", problems),
        comments = gsub("\"", "", comments)
      ) 
  )
    
  df.trials = bind_rows(
    df.trials, 
    data.frame(result_json$answers$trials) %>%
      mutate(workerid = worker.id)
  )
}


write_csv(df.trials, "../data/class-elicitation-prereg-final/class-elicitation-prereg-final-trials.csv")
write_csv(df.subject, "../data/class-elicitation-prereg-final/class-elicitation-prereg-final-subject_information.csv")
write_csv(df.attention, "../data/class-elicitation-prereg-final/class-elicitation-prereg-final-catch_trials.csv")
```


```{r load data from csv}
df.trials <- read_csv("../data/class-elicitation-prereg-final/class-elicitation-prereg-final-trials.csv")
df.subject <- read_csv("../data/class-elicitation-prereg-final/class-elicitation-prereg-final-subject_information.csv")
df.attention <- read_csv("../data/class-elicitation-prereg-final/class-elicitation-prereg-final-catch_trials.csv")
#df.frequencies <- read_csv("../data/pilot-classElicitation-free-4/webgram-freqs-unique-nps.csv")
```


### Exclusion criteria

```{r}

df.botcaptcha <- df.attention %>%
  filter(condition == "botcaptcha")

df.comprehension <- df.attention %>%
  filter(condition == "warm_up") %>%
  rowwise() %>%
  mutate(pass_comp = (
    containsString(tolower(response), "build") | 
      containsString(tolower(response), "bulid") | 
      containsString(tolower(response), "buid") |
      containsString(tolower(response), "skyscraper") | 
      containsString(tolower(response), "skyscaper") | 
      containsString(tolower(response), "structure") | 
      containsString(tolower(response), "bulding") | 
      containsString(tolower(response), "builing") |
      containsString(tolower(response), "bildin") |
      containsString(tolower(response), "towe")
      ))

# df.comprehension %>%
#   filter(!pass_comp) %>% 
#   View()

df.memory <- df.attention %>%
  filter(condition == "memory_check") %>%
  group_by(workerid) %>%
  summarize(n_correct = sum(correct),
            pass_memory = n_correct >= 7)

```

```{r}
df.memory %>%
  group_by(n_correct) %>%
  count()
```

```{r summarize catch trials}
df.attention.summary <- left_join(
  df.comprehension %>% select(workerid, pass_comp), 
  df.memory %>% select(workerid, pass_memory)) %>%
  mutate(pass_both = pass_comp & pass_memory)
  

df.attention.summary %>%
  group_by(pass_comp, pass_memory, pass_both) %>%
  count()
```



## Response processing


For automated checking of whether or not responses contain the supplied NP, we distill multi-word NPs (e.g., "six-pack of beer") to single words (e.g., beer) that we think convey the essence of the category given the context. And so, if we see a response containing the word "beer", then it will be marked as *specific* (or, including the mentioned NP). However, there are certian patterns that we deem ambiguous (e.g., using the word: "similar"), and we exclude these *($n = ?? $)*. Just to confirm, in addition, we hand-check all responses. 

```{r filtered main trails}
df.trials.filtered <- df.trials %>%
  left_join(., df.attention.summary) %>%
  filter(pass_both) %>%
  rowwise() %>%
  mutate(
    np_match = tolower(np), # additional column where we put the NP to be matched against, such that the original NPs can be accessed if necessary
    np_match = gsub("bottle of top-shelf liquor", "liquor", np_match),
    np_match = gsub("piece of chocolate", "chocolate", np_match),
    np_match = gsub("piece of chalk", "chalk", np_match),
    np_match = gsub("six-pack of beer", "beer", np_match),
    np_match = gsub("bottle of wine", "wine", np_match),
    np_match = gsub("pine tree", "pine", np_match),
    np_match = gsub("redwood tree", "redwood", np_match),
    np_match = gsub("alpine tree", "alpine", np_match),
    np_match = gsub("bonsai tree", "bonsai", np_match),
    np_match = gsub("pick-up truck", "pick-up", np_match),
    np_match = gsub("relay race", "relay", np_match),
    np_match = gsub("triathlon race", "triathlon", np_match),
    np_match = gsub("sprinting race", "sprint", np_match),
    np_match = gsub("kettle ball", "ball", np_match),
    np_match = gsub("study hall", "study", np_match),
    np_match = gsub("electric car", "electric", np_match),
    np_match = gsub("bass guitar", "bass", np_match),
    np_match = gsub("choral concert", "choral", np_match),
    np_match = gsub("rap concert", "rap", np_match),
    np_match = gsub("white paint", "white", np_match),
    np_match = gsub("blue paint", "blue", np_match),
    np_match = gsub("black paint", "black", np_match),
    np_match = gsub("limousine", "limo", np_match),
    np_match = gsub("smartcar", "smart", np_match),
    np_match = gsub("japanese restaurant", "japanese", np_match),
    np_match = gsub("chinese restaurant", "chinese", np_match),
    np_match = gsub("korean restaurant", "korean", np_match),
    np_match = gsub("elderly person", "elder", np_match),
    np_match = gsub("oil paint", "oil", np_match),
    np_match = gsub("wall paint", "wall", np_match),
    np_match = gsub("shopping mall", "mall", np_match),
    np_match = gsub("chocolate fondue", "fondue", np_match),
    np_match = gsub("cell phone", "phone", np_match),
    np_match = gsub("bear den", "bear", np_match),
    np_match = gsub("fox den", "fox", np_match),
    np_match = gsub("mouse den", "mouse", np_match),
    np_match = gsub("downtown street", "downtown", np_match),
    np_match = gsub("side road", "side", np_match),
    np_match = gsub("back door", "back", np_match),
    np_match = gsub("patio door", "patio", np_match),
    np_match = gsub("chocolate cake", "chocolate", np_match)
    )


n.total.responses <- df.trials.filtered %>%
  ungroup() %>%
  count() %>%
  pull(n)

df.trials.filtered %>% 
  group_by(degree, np) %>%
  count() 
```


```{r}
d.item.count <- df.trials.filtered %>%
  group_by(stim_id, np_expectations, adj_polarity) %>%
  count() 
d.item.count

d.item.count %>% 
  ungroup() %>% 
  group_by(n) %>% 
  count() %>%
  ggplot(., aes( x = n,y = nn))+
  geom_col()+
  xlab("n responses per item")+
  ylab("n items")

```


```{r eval=F}
# d.item.n50 <- d.item.count %>% 
#   filter(n >= 50) 
#  write(
#    jsonlite::toJSON(d.item.n50, pretty = T),
#    file = "../experiments/js/prereg-cce-n50.json"
#  )

```

We exclude invalid responses: These are the responses the are just the name of a person or just the adjective.
After the responses are analysed manually, nonsense responses were added to this list. 

```{r list of invalid responses}
invalid.responses <- c("unsure",
                              # all the adjectives
                              "long", "short", "tall", "dark", "light", "fast", "quick", "slow",
                              "hard", "soft", "loud", "noisy", "quiet", "bright", "bruises",
                              "expensive", "cheap", "big", "small", "strong", "weak", "warm", "hot", "cold",
                              "heavy", "wide", "narrow", 
                              # all the actor names
                              "alexander", "alicia", "cheep", "daniel", "darker", 
                              "david",
                              "eric", "gabriel", "anthony", "william", "john", "tom", "lucas",
                              "michael", "cameron", "stephen", 
                              "lee", "greg", "robert", "chrales",  "gary", "josh", "simon", 
                              # female names
                               "angela", "jennifer", "monica", "melinda", "veronica", "alicia",
                              "maya", "sophie", "kim", "laura", "julia",
                              "michelle", "stephanie", "claire", "kathleen", "jasmine", "tanya",
                              "mika", "natalia",
                              # invalid responses
                              "barbell snatch", "bank of america",  "easy", "empire building",  "chill", "chinn",
                              "finished", "flexibility", "health", "hot cold",
                              "lazy", "low", "cliaire", "feelings",
                                "public", "ripe" , "silent", "baked", "burn", "more costly", "exacting", 
                              # filter out the sentences without a CC
                              "A bottle of wine at a liquor store was expensive", "A piece of cotton in craft shop was light", "A piece of plastic in hardware store was soft", 
                              "A spider in an insect terrarium was big", "At the butchershop the chicken was expensive", "At the conference center it was noisy when she met her friend", "during the night its light out there",
                              "hears the cry of a crow", "In Aquarium a tuna was big", "In botanical garden an alpine tree was short.", "In summer that day was cold", "In the freezer michelle hand was cold", "it has a lot of stuff", 
                              "It was noisy in the nearby city", "its not a hot and cold", "move furniture through the front gate of her house", "picks up a piece of silk.", "the coat is light in weight", "	The coat of poodle was dark",
                              "the color of the script is light", "the daisy is dark in color", "The first bite of her ice cream was warm", "The first sip of juice was cold", "The furniture was narrow at the back door of his house", "The new place rental rate is expensive", "the pair of sandals are expensive", "	The piece of silk is light.", 
                              "the sound of the shower is strong", "The statue made of plastic was cheap", "the walls of the condo are strong", "While walking heard the cry of a rooster when it was quiet", "Basketball player was tall",
                              "Friend's new rowboat was fast","Friend's new smartcar is big", "his favorite poem was short", "it is not destructive", "it is not loud", "it is not sold expensively", "it s not wide", "its noisy in here",
                              	"its not a soft", "On Saturday it was cold", "STRIP MALL IS SHORT", "summer days are warm", "That baby was loud", "the adult walk quickly", "The airplane is slow.", "The bird is loud.", "the car drives by quietly", "the car is quite", "the child is not fussy", "The child walks slow.", "The coat of poodle was dark", 
                              "the color is not much","the day is cold", "the dog's body is long", "The environment is quiet.", "the floor is soft", "The flower is short.", "the food is expensive", "the fruit cake was light", "the information is  long", "The mall is short.", "The mattress s firm", "the melon was soft", "the mouse is small", "the pages are not many", "the pencil color is light", "The piece of silk is light.", "The country lane was narrow", "The new place rental rate is expensive.", "The poodle's coat is light.", "the powerboat makes no noise", "the rabbit is fast", "the sneakers are costly", "the statue is cheap", "the street is wide", "The weather is cold today.", "The suit was expensive", "The trash is light.", "The watermelon was light", "A rock concert was loud",
                              "the movie i hope", "all light of off", "sits on a blanket", "try a new water color",
                              "driving on a downtown street", "The spider was small", "The music was Loud",
                              "powerboat sound little quiet", "Horn was too loud", "Villa price was costly", 
                              "choral consert was too loud", "milkshake was so hot", "strip mall was tall", 
                              "plastic was so soft", "pork was too expensive", "price of raspberries expensive", 
                              "coat of a spaniel was little light", "village area was too quit to read", 
                              "elderly person was too quick", "conference room was too quiet", "instant pot was slow",
                              "tile floor was soft", "chocolate cake color was too dark", "marshmallow was soft for eat", 
                              "Blue paint is dark", "pick-ip truck was long", "sits on a bedboard.", "tails on mice",
                              "they are bold", "the blade spinning", "its finished",
                              "black", "boiling", "coat of paints", "Empire State Building", "glare", "indvidual experience", "information", "It is not loud", "It was night", "It was strong", "itrs warm", "its hot", "its low", "its low cost", "its not hard", "its not mute", "its not slow", "its not soft", "its not speed", "its too sound", "its wide", "lengthy", "less wide", "melting", "More costly", "move", "muscles", "pcks", "Relationship", "sexy", "Silent", "the duration", "the distance", "the have muscles", "they are fit", "they run fast" , "thrill", "though", "Very slow", "walking outside", "walking assistance tools", "word", "worthy", "tough", "picks up their trash can.", "all lights off", "amount"
                              )
```

```{r list of commong mispellings}
mispellings_set <- c(
        "&quotechar" = "",
         "basset" = "bassett",
         "bonzai" = "bonsai",
        "bottles of win" = "bottles of wine",
         "seagul" = "seagull",
         "seagulll" = "seagull",
        "skyscrapper" = "skycraper",
         "dalia" = "dahlia",
         "pitbul" = "pitbull",
         "panter" = "panther",
         "icecream" = "ice cream",
         "high way" = "highway",
         "ice-cream" = "ice cream",
         "bed board" = "bedboard",
         "jocky" = "jockey",
         "jockie" = "jockey",
         "dog house" = "doghouse",
         "chihuaua" = "chihuahua",
         "zuccini" = "zucchini",
         "cheeta" = "cheetah",
         "skiier" = "skier",
         "dachsund" = "dachshund",
         "brushes" = "bushes",
         "marshmellow" = "marshmallow",
         "cow" = "crow",
         "jokceys" = "jockeys",
         "marshamallow" = "marshmallow",
         "colour" = "color",
         "pickup" = "pick-up",
         "segalls" = "seagulls",
         "triatlon" = "triathlon",
         "intrument" = "instrument",
         "desert" = "dessert",
         "eliphant" = "elephant",
         "pick up" = "pick-up",
         "chruch" = "church",
         "coffe" = "coffee",
         "resturauants" = "restaurants",
         "piillow" = "pillow",
         "thunderstom" = "thunderstorm",
         "quitar" = "guitars",
         "monkees" = "monkey",
         "watermellons" = "watermelon",
         "penquin" = "penguin",
         "liqueur" = "liquor",
         "elelphant" = "elephant",
         "millshake" = "milkshake",
         "alcohol drinks" = "alcoholic drinks",
         "appliences" = "appliances",
         "braclets" = "bracelets",
         "oragne" = "orange",
         "trashcan" = "trash can",
         "buildig" = "building",
         "monekys" = "monkey",
         "ukulele" = "ukelele",
         "pit bull" = "pitbull",
         "pod cast" = "podcast",
         "dachund" = "dachshund",
         "resaurants" = "restaurants",
         "peom" = "poem",
         "braclet" = "bracelet",
         "pick truck" = "pick-up truck",
         "bassettt hound" = "bassett hound",
         "summre" = "summer",
         "blwnket" = "blanket",
         "fondu's" = "fondue",
         "aplaince" = "appliance",
         "restarant" = "restaurant",
         "concert's" = "concerts",
         "chihuaha" = "chihuahua",
         "chiahuahaua" = "chihuahua",
         "cotten" = "cotton",
         "cumcumber" = "cucumber",
         "daschshund" = "dachshund",
         "aparment" = "apartment",
         "basket ball" = "basketball",
         "bassettts" = "bassett hound",
         "dashshund" = "dachshund",
         "fruitcake" = "fruit cake",
         "mialkshake" = "milkshake",
         "liqour" = "liquor",
         "runer" = "runner",
         "pencial's" = "pencil",
         "rapberriees" = "raspberries",
         "wilk" = "silk",
         "watermeloon" = "watermelon",
         "water color" = "watercolor",
         "villiage" = "village",
         "thundersorm" = "thunderstorm",
         "tennager" = "teenager",
         "adukts" = "adults",
         "afults" = "adults",
         "blwnkets" = "blankets",
         "bottles of win" = "wine",
         "boulevatd" = "boulevard",
         "bracelet's" = "bracelets",
         "bracelts" = "bracelets",
         "centre" = "center",
         "frinch" = "finch",
         "croe" = "crow",
         "dane's" = "danes",
         "documentry" = "documentary",
         "gutiars" = "guitars",
         "paint's" = "paints",
         "raspberriees" = "raspberries",
         "rental options" = "rentals",
         "resturants" = "restaurants",
         "restaurnats" = "restaurants",
         "restuarants" = "restaurants",
         "sald" = "salad",
         "satues" = "statues",
         "sanddals" = "sandals",
         "skyscrapper" = "skyscraper",
         "spirinting" = "sprinting",
         "statue's" = "statues",
         "statutes" = "statues",
         "thundersorm" = "thunderstorm",
         "aniumal" = "animal",
         "envrionments" = "environments",
         "freind" = "friend",
         "inatrument" = "instrument",
         "instruent" = "instrument",
         "insturuments" = "instrument",
         "perty" = "party",
         "pick up" = "pick-up",
         "restaruants" = "restaurants",
         "thundertsorm" = "thunderstorm",
         "tkime of day" = "time of day"
  )
```

```{r list of common synonyms}
synonym_set = c("6 packs" = "beer",
         "golf player" = "golfer",
         "six-packs" = "beer",
         "six-pack" = "beer",
         "six packs" = "beer",
         "beverage" = "drink",
         "humans" = "people",
         "persons" = "people",
         "individuals" = "people",
         "automobile" = "car",
         "biking" = "bike",
          "booze"= "alcoholic drinks",
        "animal-made structures" = "animal houses",
        "animal noises." = "animal sound"
         "bicycle" = "bike",
         "car ride" = "drive",
         "brands of beer" = "beer",
         "mobile" = "cell",
         "fridge" = "refrigerator",
         "gym" = "gymnasium",
         "players that play a different sport" = "athletes",
         "hours of the day" = "times of day",
         "periods of the day" = "times of day",
         "parts of the day" = "times of day",
         "day times" = "times of day", 
         "times during the day" = "times of day", 
         "times in the day" = "times of day",
         "times of the day" = "times of day",
         "times of the year" = "seasons",
         "times of year" = "seasons",
         "conference room" = "conference center",
         "clothing" = "clothes",
         "parts of the day" = "times of day",
         "caves" = "dens",
         "cushion" = "pillow",
         "times when it is not as dark" = "times of day",
         "flying vehicles" = "aircrafts",
         "flying objects" = "aircrafts",
         "flying machines" = "aircrafts",
         "race courses" = "races",
         "race paths" = "races",
         "restaurant menu" = "restaurant",
         "footwear" = "shoes",
         "alochols" = "alcoholic drinks",
         "book" = "readings",
         "parites" = "party",
         "floor surfaces" = "floors",
         "floor materials" = "floors",
         "floor coverings" = "floors",
         "floor of a room" = "floors",
         "flooring" = "floors",
         "poetry" = "poem",
         "burrow" = "hole",
         "jollies" = "jolly rancher",
         "basket athletes" = "basketball players",
         "alcohol drink" = "alcoholic drink",
         "animal home" = "den",
         "choirs" = "choral",
         "animals houses" = "dens",
         "rock music" = "rock concert",
         "patios" = "patio door",
         "rug" = "carpet",
         "wooffloor" = "wood",
         "pet mouose" = "mouse",
         "fungus" = "mushroom",
         "episodes of this podcast" = "podcast episode",
         "flat" = "apartment",
         "pans for frying" = "frying pans",
         "pickup's" = "pick-up truck",
         "pick up track" = "pick-up truck",
         "podcasts he has heard" = "podcast episode",
         "podcasts listened" = "podcast episode",
         "podcasts" = "podcast episode",
         "sofa" = "couch",
         "teens" = "teenager",
         "freeway" = "highway",
         "grownup" = "adult",
         "human beings" = "people",
         "humans" = "people",
         "lumber" = "wood",
         "older adults" = "elderly person",
         "senior" = "elderly person",
         "pedestrian" = "walker")
```

```{r list of lemmatizations}
# mostly Plural --> singulars
lemmatization_set <- c("milshakes" = "milkshake",
         "monkies" = "monkey",
         "watermenlons" = "watermelon",
         "docuentaries" = "documentary",
         "gates" = "gate",
         "dasies" = "daisy",
         "pansies" = "pansy",
         "mice" = "mouse",
         "documentaries" = "documentary",
         "parties" = "party",
         "cities" = "city",
         "stirps" = "strip mall",
         "joly ranchers" = "jolly rancher",
         "auditoria" = "auditorium",
         "gymnasia" = "gymnasium",
         "cacti" = "cactus",
         "pantries" = "pantry",
         "liquors" = "liquor",
         "babies" = "baby",
         "stories" = "story",
         "berry" = "berries",
         "monkys" = "monkey",
         "libaries" = "library",
         "palnes" = "plane",
         "skarks" = "shark",
         "greats danes" = "great dane",
         "manos" = "mangos",
         "paties" = "party",
         "magoes" = "mango",
         "organes" = "orange",
         "allies" = "alley",
         "daisies" = "daisy",
         "chijldren" = "child",
         "childern" = "child",
         "libraries" = "library",
         "marhsmallows" = "marshmallow",
         "candy" = "candies")
```

``` {r excludeInvalidResps}

# excluding invalid responses 
d.tidy.resps.catch <- df.trials.filtered %>%  
  filter((grepl("it's", response, ignore.case = T) |
            grepl("they're", response, ignore.case = T)  )) 

# get invalid responses which are full sentences without any comparison class 
d.tidy.resp.valid.resps <- anti_join(
  df.trials.filtered, 
  d.tidy.resps.catch
  ) %>% rowwise() %>%
  mutate(stopPhrase = paste("the", np, "is", adj, sep=" "),
         stopPhrase2 = paste("the", np, "is", 
                             paste(adj, ".", sep=""), sep=" "),
         responseLength = lengths(str_split(response, " "))) %>%
  filter((tolower(response) != stopPhrase) &
           (tolower(response) != stopPhrase2))

# get the long responses that were not matched above and filter them out manually
#d.tidy.resp.valid.resps %>% filter(responseLength >= 4) %>% View()

d.tidy.resp.valid.resps <- d.tidy.resp.valid.resps %>% 
  rowwise() %>%
  # exclude responses which excatly match the ones in the following list
  subset(., !(response %in% invalid.responses))

n.valid.responses <- d.tidy.resp.valid.resps %>%
  ungroup() %>%
  count() %>%
  pull(n)

n.total.responses - n.valid.responses
# check
# d.tidy.resp.valid.resps %>% 
#   filter(responseLength >= 4) %>% 
#   View()
```

We correct for common misspellings in the responses. 



We treat certain responses as synonymous with our supplied NPs given the context.

We also replace a few common responses with synonyms, which match our supplied NPs better (e.g., NP =  "car ride", common response = "other drives"). Some replacements are more specific 
(Based on pilot data, specific mistakes and synonyms are converted to the seed NPs.). 
All irregular plurals in the set set are converted to singulars to match the seed noun phrase. 



```{r}
d.tidy.resp.valid.resps %>% 
  mutate(response = as.character(response)) %>%
  ungroup() %>%
  mutate(
    response_spelling = str_replace_all(response, mispellings_set),
    response_synonym = str_replace_all(response_spelling, synonym_set),
    response_lemma = tolower(str_replace_all(response_synonym, lemmatization_set))
    ) %>%
  mutate(corrected_spelling = response != response_spelling,
         corrected_synonym = response_spelling != response_synonym,
         corrected_lemma = response_synonym != response_lemma) -> d.tidy.resp.valid.resps

sum(d.tidy.resp.valid.resps$corrected_spelling)
sum(d.tidy.resp.valid.resps$corrected_spelling) / n.valid.responses
sum(d.tidy.resp.valid.resps$corrected_synonym)
sum(d.tidy.resp.valid.resps$corrected_synonym) / n.valid.responses
sum(d.tidy.resp.valid.resps$corrected_lemma)
sum(d.tidy.resp.valid.resps$corrected_lemma) / n.valid.responses

```


This code no longer cleans the responses by removing stop words. That latter method produces issues for the "pick-up truck" (which it doesn't match correctly), times of day, and some responses involved "The + Singular_NP" (which are ambiguous and should be excluded).  

How should "times of day" be coded?

```{r}
d.tidy.resp.valid.resps %>%
    rowwise() %>%
  mutate(
    response_lemma = as.character(response_lemma),
    cleanedPhrase = paste("_", as.character(response_lemma), "_", sep = ""), # add buffer to allow for split to occur at beginning or end
    np_match = as.character(np_match),
    np_match = gsub('\"', "", np_match),
    np_match_us = paste("_", np_match, "_", sep=""), # insert underscores for the matching the other way around 
    super_us = paste("_", superordinate, "_", sep=""),
  # check if response and seed NP match 
    specific = #ifelse(
      # response_lemma == "times of day", # catch these responses because otherwise classified as subordinate for "day" / "strawberries" etc
      ifelse(response_lemma == "berries", 0, 
      containsString_responses(
        as.character(cleanedPhrase), 
        np_match, 
        response_lemma, 
        np_match_us
        )
      ),
  # check if response and anticipated superordinate match
    matchingSuper = containsString_responses(
      as.character(cleanedPhrase), 
      as.character(superordinate), 
      response_lemma, 
      super_us)
  ) -> d.tidy.phrase.w.original2
```


```{r codeForSubCatTerms}

# clean produced responses to match NPs 
# d.tidy.resp.valid.resps %>% 
#   unnest_tokens(word, response_lemma)  %>%  # break responses into single words (one per line)
#   anti_join(my_stop_words) %>%  # remove stop words
#   group_by(workerid, trial_num) %>% # next four functions are to put phrases back together again
#   mutate(wordNumber = paste("word_", row_number(), sep = "")) %>%
#   spread(wordNumber, word) %>%
#   unite(phrase, starts_with("word_"), sep = " ") %>%
#   mutate(phrase = gsub(" NA", "", phrase)) %>%
#   left_join(
#     df.trials.filtered %>% 
#       select(workerid, trial_num, response)
#     ) %>% 
#   rename(cleanedPhrase = phrase, originalResponse = response) %>% 
#   rowwise() %>%
#   mutate(
#     originalPhrase = as.character(cleanedPhrase),
#     cleanedPhrase = paste("_", as.character(cleanedPhrase), "_", sep = ""), # add buffer to allow for split to occur at beginning or end
#     np_match = as.character(np_match),
#     np_match = gsub('\"', "", np_match),
#     np_match_us = paste("_", np_match, "_", sep=""), # insert underscores for the matching the other way around 
#     super_us = paste("_", superordinate, "_", sep=""),
#   # check if response and seed NP match 
#     specific = ifelse(
#       originalPhrase == "times of day", # catch these responses because otherwise classified as subordinate for "day" / "strawberries" etc
#       ifelse(originalPhrase == "berries", 0, 0), 
#       containsString_responses(
#         as.character(cleanedPhrase), 
#         np_match, 
#         originalPhrase, 
#         np_match_us
#         )
#       ),
#   # check if response and anticipated superordinate match
#     matchingSuper = containsString_responses(
#       as.character(cleanedPhrase), 
#       as.character(superordinate), 
#       originalPhrase, 
#       super_us)
#   ) -> d.tidy.phrase.w.original
 
# d.tidy.phrase.w.original %>%
#   group_by(stim_id, np_expectations, adj_polarity) %>%
#   count() %>% 
#   View()
```

``` {r}
# remove responses with uncertainty marker "similar" for more restrictive analysis
# d.tidy.phrase.w.original %>% 
#   filter(grepl("similar", originalResponse, ignore.case=T)) -> d.uncertain.resps # 15 responses

d.tidy.phrase.w.original2 %>% 
  filter(grepl("similar", response_lemma, ignore.case=T)) -> d.uncertain.resps # 15 responses

d.tidy.clean.responses <- anti_join(
  d.tidy.phrase.w.original2, 
  d.uncertain.resps)

# extrcat the automatically matched data (out of 26.552 responses (post exclusion) 22.117 are matched )
d.matchedResponses <- d.tidy.clean.responses %>% 
  filter((specific == 1) | (matchingSuper == 1))

n.automatic.responses <- d.matchedResponses %>% 
  ungroup() %>% count() %>% pull(n)

n.automatic.responses / n.valid.responses

# d.tidy.phrase.w.original %>%
#   select(workerid, trial_num, cleanedPhrase, specific, matchingSuper) %>%
#   rename(method_1 = specific, method_1_super = matchingSuper, method_1_cleanedPhrase = cleanedPhrase) %>%
#   right_join(., d.tidy.phrase.w.original2) %>%
#   mutate(match_specific = method_1 == specific, 
#          match_super = method_1_super == matchingSuper,
#          mismatch = match_specific & match_super) -> d.tidy.phrase.w.original.compare
#   
# d.tidy.phrase.w.original2
```

```{r}
# extract the consistent responses based on automatically classified data
# d.sub.counts <- d.matchedResponses %>%
#   group_by(stim_id, np_expectations, adj_polarity) %>%
#   count(specific)

# d.confident.phrase.specificMarking.bs.item <- d.matchedResponses %>% 
#   group_by(stim_id, degree, superordinate, 
#            np_expectations, np, adj_polarity) %>%
#   count(specific) %>%
#   mutate(nr = sum(n))

#d.sub.counts
# 
# d.consistent.items <- d.sub.counts %>% 
#   group_by(stim_id, np_expectations, adj_polarity) %>% 
#   mutate(nr_dp = sum(n)) %>% 
#   filter(n >= nr_dp-2) # extract the consistent items 
# 
# #d.consistent.items
# d.inconsistent.items <- anti_join(d.sub.counts, d.consistent.items)
# #d.inconsistent.items



# d.confident.phrase.specificMarking.bs.item %>% 
#   filter((n == 0) | (n == nr))

# check the matched items where the mean of responses is 1 or 0
d.matchedResponses %>% 
  group_by(stim_id, np_expectations, adj_polarity) %>% 
  mutate(meanResp = mean(specific)) %>% 
  filter((meanResp == 1) | (meanResp == 0)) %>% 
  distinct(stim_id, np_expectations, 
           np_match, adj_polarity, response_lemma, meanResp) %>% 
  View()

# it happns for some items where the number of matched responses is very low, e.g. for the NP "pick-up truck", positive adjective, only 3 responses out of 44 are matched automatically

# d.matchedResponses %>% 
#   group_by(stim_id, np_expectations, adj_polarity) %>% 
#   count() %>% 
#   View()
```


``` {r nonMatchedResps}
# look at the unique non-matched responses
d.tidy.resp.analysis <- anti_join(
  d.tidy.phrase.w.original2, 
  d.matchedResponses)

d.tidy.resp.analysis <- d.tidy.phrase.w.original2 %>% 
  filter(!((specific == 1) | (matchingSuper == 1)))

length(d.tidy.resp.analysis)

d.tidy.resp.analysis %>% 
  distinct(np, adj, np_match, response_lemma, cleanedPhrase, specific, matchingSuper) %>% 
  View()
```

Here, we look at the responses that were not matched to our anticipated NPs and superordinates and the synonyms of the NPs we already caught. We judge if the deviating responses are synonymous to our seed NPs or our superordinates and match them.

```{r}



# categorize the responses upon looking at the reponses not matching the NP nor the superordinate

# this is the more sketchy part of the classification
# also, responses that are synonyms of other non-matching responses are mutated in order to receive accurate modal responses

# first , the responses which are held to be subordinate responses are changed to the seed subordinate NPs 

# the substituted word forms might seem weird because the stop words are removed. For context, see original responses
d.tidy.phrase.handClassified <- d.tidy.resp.analysis %>% 
  
  # sketchy subordinate synonyms 
  mutate(cat_cleanedPhrase = cleanedPhrase,
         cat_cleanedPhrase = gsub("'", "", cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse( superordinate == "cookware", 
                                     gsub("pans", "frying pan", cat_cleanedPhrase),
                                     cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("computer", "laptop", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("dane", "great dane", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("podcast", "podcast episode", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("illunation", np_match, cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("illumination", np_match, cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "desserts",  gsub("chocolate", "chocolate fondue",
                                                                       cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "times of day",  
                                    ifelse(cat_cleanedPhrase == "days", np_match,
                                                                             cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "writing utensils",  gsub("ink", "pen", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "buildings",  gsub("apartments", "apartment building",
                                                                        cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("rain", "rain shower", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("shower", "rain shower", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("amount", "beer", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("bags of trash", "trash can", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("brands", np_match, cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("butchershops", np_match, cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "places",  gsub("baths", "sauna", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "alcoholic drinks",  gsub("bottles", "wine", cat_cleanedPhrase),
                              cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "furniture",  gsub("cans", "trash cans", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "loudness",  gsub("child", "baby", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "weight",  gsub("children", "kid", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "weight",  gsub("childern", "kid", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("chocolate", "chocolate fondue",
                                                                     cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("duck", "dusk", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("cell hone", "phone", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("cites", "city", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("compared store", np_match, cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("cry frinch", "finch", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("cycles", "motorcycle", cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("color", np_match, cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("fur color", np_match, cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("fur", np_match, cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("day", np_match, cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "loudness_n",  gsub("day", np_match, cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "price",  gsub("day", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "price",  gsub("flats", "apartments", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "speed",  gsub("kid", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "height",  gsub("kid", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "loudness",  gsub("kid", np_match, cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "strength",  gsub("kid", np_match, cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "weight",  gsub("kid", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "width",  gsub("lane", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("light", np_match, cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "height",  gsub("mall", np_match, cat_cleanedPhrase),
                                    cat_cleanedPhrase),
        cat_cleanedPhrase = ifelse(degree == "speed_f",  gsub("planes", np_match, cat_cleanedPhrase),
                                   cat_cleanedPhrase),
        cat_cleanedPhrase = ifelse(degree == "height",  gsub("player", np_match, cat_cleanedPhrase),
                                   cat_cleanedPhrase),
        cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("rinks", np_match, cat_cleanedPhrase),
                                   cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("saturday", np_match, cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(superordinate == "animals",  gsub("shade", np_match, cat_cleanedPhrase),
                                 cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "loudness_n",  gsub("time", np_match, cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("time", np_match, cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "speed",  gsub("time", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "price",  gsub("time", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "darkness",  gsub("time", "times of day", cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "price",  gsub("store", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "price",  gsub("shop", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "size",  gsub("store", np_match, cat_cleanedPhrase), cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "loudness_n",  gsub("store", np_match, cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "length_duration",  gsub("store", np_match, cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(degree == "temperature_h",  gsub("sip", np_match, cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(superordinate == "animals",  gsub("color", np_match, cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(superordinate == "dogs",  gsub("color", np_match, cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(superordinate == "cakes",  gsub("color", np_match, cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(superordinate == "flowers",  gsub("color", np_match, cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(superordinate == "materials",  gsub("color", np_match, cat_cleanedPhrase),
                                  cat_cleanedPhrase),
       cat_cleanedPhrase = ifelse(superordinate == "birds",  gsub("color", np_match, cat_cleanedPhrase),
                                 cat_cleanedPhrase),
          cat_cleanedPhrase = gsub("gorilla", "monkey", cat_cleanedPhrase),
          cat_cleanedPhrase = gsub("hounds", "bassett hound", cat_cleanedPhrase),
          cat_cleanedPhrase = gsub("pages", "novel", cat_cleanedPhrase),
          cat_cleanedPhrase = gsub("water tempertatures", "sauna", cat_cleanedPhrase),

      # superordinates and non-matchinf synonyms
         cat_cleanedPhrase = gsub("flying craft", "aircrafts", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("flying things", "aircrafts", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("forest spaces", "forest", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("wheelers", "vehicles", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("passageways", "doorways", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("areas around", "areas", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("hours", "times of day", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("animal movement", "animal", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("home", "house", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("door passages", "doorways", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("shows", "entertainment", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("roadway", "road", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("liuids", "drinks", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("watercraft", "boat", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("types of restaurant food", "food", cat_cleanedPhrase),
         cat_cleanedPhrase =ifelse(degree == "darkness",  gsub("times", "times of day", cat_cleanedPhrase),
                                   cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("top shelf options", "liquor", cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(degree == "price", gsub("rent", "rentals", cat_cleanedPhrase), cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("other computer equipment", "electronic devices", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("bodies of water", "waterways", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("places to rent", "rentals", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("ways too cook food", "cookware", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("door openings", "doorways", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("wall supports", "walls", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("things in the air", "aircrafts", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("places to live", "rentals", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("flower bouquets", "bouquet", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("flower bouquet", "bouquet", cat_cleanedPhrase),
        cat_cleanedPhrase = gsub("holes", "dens", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("flower arrangements", "bouquet", cat_cleanedPhrase),
        cat_cleanedPhrase = gsub("entrances", "doorways", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("entryways", "doorways", cat_cleanedPhrase),

         cat_cleanedPhrase = gsub("door openings", "doorways", cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "paints",  gsub("color", "paint", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "seasons",  gsub("day", "seasons", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "statues",  gsub("material", "statues", cat_cleanedPhrase),
                              cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "insects",  gsub("bug", "insect", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "cookware",  gsub("cook", "cookware", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = ifelse(superordinate == "venues",  gsub("auditoriums", "concert", cat_cleanedPhrase),
                                    cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("meals restaurant", "restaurant", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("bouquets", "bouquet", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("bodys water", "waterways", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("bodies water", "waterways", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("bouqet", "bouquet", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("competition", "race", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("concert music", "concerts", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("condiments", "spices", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("activities", "places", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("animal houses openings", "animal houses", cat_cleanedPhrase),
   
   # classification of those responses which were not caught above (looking at d.tidy.resp.analysis.update below): mostly adjusting synonymous responses to get accurate mode estinates
         cat_cleanedPhrase = gsub("air room", "air", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("ambient temperatures", "temperatures", cat_cleanedPhrase),

         cat_cleanedPhrase = gsub("animals aquiariums", "animals", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("animals forest", "animals", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("animals forrest", "animals", cat_cleanedPhrase),
         cat_cleanedPhrase = gsub("animals forest", "animals", cat_cleanedPhrase),
         ) %>%
  mutate( cat_cleaned = gsub("_", "", cat_cleanedPhrase),
    specific = containsString_responses(as.character(cat_cleanedPhrase), as.character(np_match), cat_cleaned,  np_match_us), 
         matchingSuper = containsString_responses(as.character(cat_cleanedPhrase), as.character(superordinate), cat_cleaned, super_us)
         ) 

# check unclassified responses left
d.tidy.resp.analysis.update <- d.tidy.phrase.handClassified %>% filter((specific == 0) & (matchingSuper == 0)) #  %>% distinct(degree, superordinate, super_us, np, adj, np_match, np_match_us, originalResponse, cleanedPhrase, cat_cleanedPhrase, specific, matchingSuper)
```


``` {r}
# sketchy superordinate classification and non-matchin synonym alignment 
# the responses which were not matched above are further classified here
d.tidy.phase.classifiedSuper <- d.tidy.resp.analysis.update %>%
  mutate(
    cleanedPhrase = cat_cleanedPhrase,
    cleanedPhrase = gsub("pieces of", "", cleanedPhrase),
    cleanedPhrase = gsub("alcohol drinks", "alcoholic drinks", cleanedPhrase),
    cleanedPhrase = gsub("animal houses", "dens", cleanedPhrase),
    cleanedPhrase = gsub("animal noise", "animal sound", cleanedPhrase),
    cleanedPhrase = gsub("aniumals", "animals", cleanedPhrase),
    cleanedPhrase = gsub("apartmets", "apartments", cleanedPhrase),
    cleanedPhrase = ifelse(degree == "speed", gsub("appliances", "cookware", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = gsub("aquariums", "aquarium", cleanedPhrase),
    cleanedPhrase = gsub("athelete", "athlete", cleanedPhrase),
    cleanedPhrase = gsub("barries", "berries", cleanedPhrase),
    cleanedPhrase = gsub("bird cries", "bird sound", cleanedPhrase),
    cleanedPhrase = gsub("bird species", "birds", cleanedPhrase),
    cleanedPhrase = gsub("bird loud", "bird sound", cleanedPhrase),
    cleanedPhrase = gsub("bird sounds", "bird sound", cleanedPhrase),
    cleanedPhrase = gsub("bodys of water", "waterways", cleanedPhrase),
    cleanedPhrase = gsub("boxes", "box", cleanedPhrase),
    cleanedPhrase = gsub("boxs", "box", cleanedPhrase),
    cleanedPhrase = gsub("bracelts", "bracelets", cleanedPhrase),
    cleanedPhrase = gsub("buildings", "building", cleanedPhrase),
    cleanedPhrase = gsub("blwnkets", "blanket", cleanedPhrase),
    cleanedPhrase = gsub("chacolate", "chocolate", cleanedPhrase),
    cleanedPhrase = gsub("chocholate", "chocolate", cleanedPhrase),
    cleanedPhrase = gsub("clothes", "cloth", cleanedPhrase),
    cleanedPhrase = gsub("cloths", "cloth", cleanedPhrase),
    cleanedPhrase = gsub("coat of animals", "animal coat", cleanedPhrase),
    cleanedPhrase = gsub("coats", "coat", cleanedPhrase),
    cleanedPhrase = gsub("cockpots", "crockpot", cleanedPhrase),
    cleanedPhrase = gsub("craft supplies", "materials", cleanedPhrase),
    cleanedPhrase = gsub("crafts", "materials", cleanedPhrase),
    cleanedPhrase = gsub("compared noise", "noise", cleanedPhrase),
    cleanedPhrase = gsub("creators", "creatures", cleanedPhrase),
    cleanedPhrase = gsub("car models", "cars", cleanedPhrase),
    cleanedPhrase = gsub("cry of finch", "finch", cleanedPhrase),
    cleanedPhrase = gsub("crying", "cries", cleanedPhrase),
    cleanedPhrase = gsub("days", "day", cleanedPhrase),
    cleanedPhrase = gsub("dinners", "dinner", cleanedPhrase),
    cleanedPhrase = gsub("distances", "distance", cleanedPhrase),
    cleanedPhrase = gsub("documentry", "documentary", cleanedPhrase),
    cleanedPhrase = gsub("dog hair", "dogs", cleanedPhrase),
    cleanedPhrase = gsub("dog coat", "dogs", cleanedPhrase),
    cleanedPhrase = gsub("aromatics", "spices", cleanedPhrase),
    cleanedPhrase = gsub("door of house", "doorways", cleanedPhrase),
    cleanedPhrase = gsub("drink choices", "drinks", cleanedPhrase),
    cleanedPhrase = gsub("environments", "environment", cleanedPhrase),
    cleanedPhrase = gsub("fabrics", "fabric", cleanedPhrase),
    cleanedPhrase = gsub("floor types", "floors", cleanedPhrase),
    cleanedPhrase = gsub("floor styles", "floors", cleanedPhrase),
    cleanedPhrase = gsub("flyers", "aircrafts", cleanedPhrase),
    cleanedPhrase = gsub("food items", "food", cleanedPhrase),
    cleanedPhrase = gsub("food products", "food", cleanedPhrase),
    #cleanedPhrase = gsub("food expensive", "food", cleanedPhrase),
    cleanedPhrase = gsub("food served", "food", cleanedPhrase),
    cleanedPhrase = gsub("foods", "food", cleanedPhrase),
    cleanedPhrase = gsub("forest paths", "forest", cleanedPhrase),
    cleanedPhrase = gsub("forest sounds", "sounds", cleanedPhrase),
    cleanedPhrase = gsub("forests", "forest", cleanedPhrase),
    cleanedPhrase = gsub("forms of transportation", "transportation", cleanedPhrase),
    cleanedPhrase = gsub("fowers", "flowers", cleanedPhrase),
    cleanedPhrase = gsub("fruits", "fruit", cleanedPhrase),
    cleanedPhrase = gsub("furniture of type", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("furniture pieces", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("furniture sizes", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("furnitures", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("gutiars", "guitars", cleanedPhrase),
    cleanedPhrase = gsub("highways", "highway", cleanedPhrase),
    cleanedPhrase = gsub("home", "house", cleanedPhrase),
    cleanedPhrase = gsub("houses", "house", cleanedPhrase),
    cleanedPhrase = gsub("housing", "rental", cleanedPhrase),
    cleanedPhrase = gsub("insect terrarium", "insects", cleanedPhrase),
    cleanedPhrase = gsub("instruments heard", "instruments", cleanedPhrase),
    cleanedPhrase = gsub("instruments played", "instruments", cleanedPhrase),
    cleanedPhrase = gsub("instuments", "instruments", cleanedPhrase),
    cleanedPhrase = gsub("items bought", "items", cleanedPhrase),
    cleanedPhrase = gsub("items ground", "items", cleanedPhrase),
    cleanedPhrase = gsub("items hardware store", "items", cleanedPhrase),
    cleanedPhrase = gsub("items kitchen", "items", cleanedPhrase),
    cleanedPhrase = gsub("items pick up", "items", cleanedPhrase),
    cleanedPhrase = gsub("items store", "items", cleanedPhrase),
    cleanedPhrase = gsub("jewelery", "jewelry", cleanedPhrase),
    cleanedPhrase = gsub("jewelery", "jewelry", cleanedPhrase),
    cleanedPhrase = gsub("kids age", "kid", cleanedPhrase),
    cleanedPhrase = gsub("kitchens", "kitchen", cleanedPhrase),
    cleanedPhrase = gsub("kitchenware", "cookware", cleanedPhrase),
    cleanedPhrase = gsub("lakes", "lake", cleanedPhrase),
    cleanedPhrase = gsub("levels of sound", "sound", cleanedPhrase),
    cleanedPhrase = gsub("libraries", "library", cleanedPhrase),
    cleanedPhrase = gsub("loud machines", "machines", cleanedPhrase),
    cleanedPhrase = gsub("machinery", "machines", cleanedPhrase),
    cleanedPhrase = gsub("meals resataurants", "restaurants", cleanedPhrase),
    cleanedPhrase = gsub("market foods", "food", cleanedPhrase),
    cleanedPhrase = gsub("market", np_match, cleanedPhrase),
    cleanedPhrase = gsub("previous cars", "cars", cleanedPhrase),
    cleanedPhrase = gsub("sea creatures", "sealife", cleanedPhrase),
    cleanedPhrase = gsub("marine life", "sealife", cleanedPhrase),
    cleanedPhrase = gsub("desswerts", "desserts", cleanedPhrase),
    cleanedPhrase = gsub("means of transportation", "transportation", cleanedPhrase),
    cleanedPhrase = gsub("meeting rooms", "meeting hall", cleanedPhrase),
    cleanedPhrase = gsub("menus", "menu", cleanedPhrase),
    cleanedPhrase = gsub("bracelet", "bracelets", cleanedPhrase),
    cleanedPhrase = gsub("metals", "metal", cleanedPhrase),
    cleanedPhrase = gsub("methods of transportation", "transportation", cleanedPhrase),
    cleanedPhrase = gsub("move furniture", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("movies", "movie", cleanedPhrase),
    cleanedPhrase = gsub("music sounds", "music", cleanedPhrase),
    cleanedPhrase = gsub("music instrument", "muical instruments", cleanedPhrase),
    cleanedPhrase = gsub("noises", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise area", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise forest night", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise hears", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise lake", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise park", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise  nearby", "noise", cleanedPhrase),
    cleanedPhrase = gsub("object kitchen", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects house", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects kitchen", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects lift", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects lifted", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects sitting", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects store", "objects", cleanedPhrase),
    cleanedPhrase = gsub("objects terrarium", "objects", cleanedPhrase),
    cleanedPhrase = gsub("openings earth", "openings", cleanedPhrase),
    cleanedPhrase = gsub("objects house", "objects", cleanedPhrase),
    cleanedPhrase = gsub("papers writing scripts", "paper", cleanedPhrase),
    cleanedPhrase = gsub("parks", "park", cleanedPhrase),
    cleanedPhrase = gsub("pathways", "path", cleanedPhrase),
    cleanedPhrase = gsub("people lifting weights", "people", cleanedPhrase),
    cleanedPhrase = gsub("person", "people", cleanedPhrase),
    cleanedPhrase = gsub("peunguins", "penguin", cleanedPhrase),
    cleanedPhrase = gsub("playing", np_match, cleanedPhrase),
    cleanedPhrase = gsub("prices", "price", cleanedPhrase),
    cleanedPhrase = gsub("properties", "rentals", cleanedPhrase),
    cleanedPhrase = gsub("race distance", "races", cleanedPhrase),
    cleanedPhrase = gsub("raspberriees", "raspberries", cleanedPhrase),
    cleanedPhrase = gsub("real estate", "rentals", cleanedPhrase),
    cleanedPhrase = gsub("restaraunts", "restaurants", cleanedPhrase),
    cleanedPhrase = gsub("restaraunt prices", "restaurants", cleanedPhrase),
    cleanedPhrase = gsub("rooms building venue", "venues", cleanedPhrase),
    cleanedPhrase = gsub("rooms house", "rooms", cleanedPhrase),
    cleanedPhrase = gsub("satues", "statues", cleanedPhrase),
    cleanedPhrase = gsub("saturday nights", np_match, cleanedPhrase),
    cleanedPhrase = gsub("script writings", "script", cleanedPhrase),
    cleanedPhrase = gsub("scripts", "script", cleanedPhrase),
    cleanedPhrase = gsub("seacreatures", "sealife", cleanedPhrase),
    cleanedPhrase = gsub("selling price", "price", cleanedPhrase),
    cleanedPhrase = gsub("shades stronger characteristic", "paints", cleanedPhrase),
    cleanedPhrase = gsub("snack foods", "snacks", cleanedPhrase),
    cleanedPhrase = gsub("sofas", "couch", cleanedPhrase),
    cleanedPhrase = gsub("satues", "statues", cleanedPhrase),
    cleanedPhrase = gsub("songs played", "songs", cleanedPhrase),
    cleanedPhrase = gsub("sounds forest", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds area", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds lake", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds moment", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds nearby", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds park", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds vicinity", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sounds", "sound", cleanedPhrase),
    cleanedPhrase = gsub("spa services", "sauna", cleanedPhrase),
    cleanedPhrase = gsub("sounds area", "sound", cleanedPhrase),
    cleanedPhrase = gsub("spirinting race", "sprint", cleanedPhrase),
    cleanedPhrase = gsub("statutes", "statues", cleanedPhrase),
    cleanedPhrase = gsub("stringed instruments", "string instruments", cleanedPhrase),
    cleanedPhrase = gsub("surfaces sit", "surfaces", cleanedPhrase),
    cleanedPhrase = gsub("terrarium's", "terrariums", cleanedPhrase),
    cleanedPhrase = gsub("thundersorms", "thunderstorm", cleanedPhrase),
    cleanedPhrase = gsub("transportation methods", "transportation", cleanedPhrase),
    cleanedPhrase = gsub("types of music", "music", cleanedPhrase),
    cleanedPhrase = ifelse(superordinate == "places", sub("venues", "places", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse(superordinate == "concerts", sub("singing", "concerts", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = gsub("water color", "watercolor", cleanedPhrase),
    cleanedPhrase = gsub("watercoolers", "watercolor", cleanedPhrase),
    cleanedPhrase = gsub("weather events", "weather", cleanedPhrase),
    cleanedPhrase = gsub("weather conditions", "weather", cleanedPhrase),
    cleanedPhrase = gsub("weather patterns", "weather", cleanedPhrase),
    cleanedPhrase = gsub("weight lifter", "weightlifter", cleanedPhrase),
    cleanedPhrase = gsub("wooffloor", "wood", cleanedPhrase),
    cleanedPhrase = gsub("furnature", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("alochols", "alcoholic drinks", cleanedPhrase),
    cleanedPhrase = gsub("random wood", "wood", cleanedPhrase),
    cleanedPhrase = gsub("areas furniture", "areas", cleanedPhrase),
    cleanedPhrase = gsub("areas kitchen", "areas", cleanedPhrase),
    cleanedPhrase = gsub("areas nearby", "areas", cleanedPhrase),
    cleanedPhrase = gsub("areas of house", "areas", cleanedPhrase),
    cleanedPhrase = gsub("areas of population", "areas", cleanedPhrase),
    cleanedPhrase = gsub("areas of space", "areas", cleanedPhrase),
    cleanedPhrase = gsub("banks", "bank", cleanedPhrase),
    cleanedPhrase = gsub("areas sound", "areas", cleanedPhrase),
    cleanedPhrase = gsub("bird call", "bird sound", cleanedPhrase),
    cleanedPhrase = gsub("birds zoo", "birds", cleanedPhrase),
    cleanedPhrase = ifelse( degree == "strength", gsub("body", "athlete", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "materials", gsub("cloth", "fabric", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "shoes", gsub("shes", "shoes", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "concerts", gsub("show", "concert", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "audios", gsub("show", "audio", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "statues", gsub("metal", "statue", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "cookware", gsub("method", "cookware", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "venues", gsub("night", np_match, cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "doorways", gsub("opening", "doorway", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "dens", gsub("opening", "den", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "times of day", gsub("area", np_match, cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "times of day", gsub("places", np_match, cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "times of day", gsub("area", np_match, cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "times of day", gsub("street", np_match, cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "rentals", gsub("places", "rentals", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "food", gsub("dishes", "food", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "restaurants", gsub("places", "restaurants", cleanedPhrase),
                            cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "restaurants", gsub("places dinner", "restaurants", cleanedPhrase),
                            cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "alcoholic drinks", gsub("places", np_match, cleanedPhrase),
                            cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "doorways", gsub("path", "doorway", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "dens", gsub("passage", "den", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "roads", gsub("path", "road", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "waterways", gsub("path", "waterways", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "audios", gsub("performance", "audio", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "audios", gsub("music", "audio", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "materials", gsub("hardware", "materials", cleanedPhrase),
                            cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "audios", gsub("performance", "venues", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "locations", gsub("places house", "locations", cleanedPhrase),
                            cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "locations", gsub("places kitchen", "locations", cleanedPhrase),
                            cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "locations", gsub("refrigerator", "freezer", cleanedPhrase),
                            cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "doorways", gsub("places house", "doorways", cleanedPhrase),
                            cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "floors", gsub("surfaces", "floors", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "races", gsub("tracks", "races", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "restaurants", gsub("menu", "restaurants", cleanedPhrase),
                            cleanedPhrase),
    cleanedPhrase = ifelse( superordinate == "walls", gsub("building materials", "walls", cleanedPhrase),
                            cleanedPhrase),
    cleanedPhrase = gsub("buildings materials", "building", cleanedPhrase),
    cleanedPhrase = gsub("cars highway", "cars", cleanedPhrase),
    cleanedPhrase = gsub("climates", "places", cleanedPhrase),
    cleanedPhrase = gsub("coat of animals", "animal coat", cleanedPhrase),
    cleanedPhrase = gsub("cold things", "things", cleanedPhrase),
    cleanedPhrase = gsub("concert volumes", "concert", cleanedPhrase),
    cleanedPhrase = gsub("conferences", "conference center", cleanedPhrase),
    cleanedPhrase = gsub("convert", "concert", cleanedPhrase),
    cleanedPhrase = gsub("costs of living", "rentals", cleanedPhrase),
    cleanedPhrase = gsub("crawly animals", "animals", cleanedPhrase),
    cleanedPhrase = gsub("creams", "ice cream", cleanedPhrase),
    cleanedPhrase = ifelse( cleanedPhrase == "_cries_", np_match_us, cleanedPhrase),
    cleanedPhrase = ifelse( cleanedPhrase == "_crying_", np_match_us, cleanedPhrase),
    cleanedPhrase = ifelse( cleanedPhrase == "_episodes_", np_match_us, cleanedPhrase),
    cleanedPhrase = ifelse( cleanedPhrase == "_car_", "_cars_", cleanedPhrase),
    cleanedPhrase = ifelse( cleanedPhrase == "_map_", "_maps_", cleanedPhrase),
    cleanedPhrase = ifelse( cleanedPhrase == "_pots_", "_cookware_", cleanedPhrase),
    cleanedPhrase = ifelse( cleanedPhrase == "_settings_", super_us, cleanedPhrase),
    cleanedPhrase = gsub("crowds", "concerts", cleanedPhrase),
    cleanedPhrase = gsub("decorations", "decor", cleanedPhrase),
    cleanedPhrase = gsub("decors", "decor", cleanedPhrase),
    cleanedPhrase = gsub("diners methods", "cookware", cleanedPhrase),
    cleanedPhrase = gsub("dog breeds", "dogs", cleanedPhrase),
    cleanedPhrase = gsub("domiciles", "rentals", cleanedPhrase),
    cleanedPhrase = gsub("door sizes", "doorways", cleanedPhrase),
    cleanedPhrase = gsub("door ways", "doorways", cleanedPhrase),
    cleanedPhrase = gsub("doors house", "doors", cleanedPhrase),
    cleanedPhrase = gsub("driving", "vehicle", cleanedPhrase),
    cleanedPhrase = gsub("fluid", "liquid", cleanedPhrase),
    cleanedPhrase = gsub("eateries", "restaurant", cleanedPhrase),
    cleanedPhrase = gsub("eatermelon", "watermelon", cleanedPhrase),
    cleanedPhrase = gsub("entrance den", "den", cleanedPhrase),
    cleanedPhrase = gsub("fabric material", "material", cleanedPhrase),
    cleanedPhrase = gsub("decor sale", "decor", cleanedPhrase),
    cleanedPhrase = gsub("decor plan buy", "decor", cleanedPhrase),
    cleanedPhrase = gsub("friends", "friend", cleanedPhrase),
    cleanedPhrase = gsub("front of house", "front gate", cleanedPhrase),
    cleanedPhrase = gsub("fuel economy cars", "smartcar", cleanedPhrase),
    cleanedPhrase = gsub("gas engine cars", "cars", cleanedPhrase),
    cleanedPhrase = gsub("gates", "front gate", cleanedPhrase),
    cleanedPhrase = gsub("gates", "front gate", cleanedPhrase),
    cleanedPhrase = gsub("gents", "men", cleanedPhrase),
    cleanedPhrase = gsub("google map", "length", cleanedPhrase),
    cleanedPhrase = gsub("griter", "guitar", cleanedPhrase),
    cleanedPhrase = gsub("groceries", "food", cleanedPhrase),
    cleanedPhrase = gsub("heavier weights", "weights", cleanedPhrase),
    cleanedPhrase = gsub("heavy traffic", "traffic", cleanedPhrase),
    cleanedPhrase = gsub("heavy equipment construction", "vehicles", cleanedPhrase),
    cleanedPhrase = gsub("herbs", "spices", cleanedPhrase),
    cleanedPhrase = gsub("highway speeds", "vehicles", cleanedPhrase),
    cleanedPhrase = gsub("hot food", "food", cleanedPhrase),
    cleanedPhrase = gsub("household items", "items", cleanedPhrase),
    cleanedPhrase = gsub("indoor area", "venue", cleanedPhrase),
    cleanedPhrase = gsub("indoor event", "event", cleanedPhrase),
    cleanedPhrase = gsub("indoor retail stores", "store", cleanedPhrase),
    cleanedPhrase = gsub("indoor space", "venue", cleanedPhrase),
    cleanedPhrase = gsub("venues", "venue", cleanedPhrase),
    cleanedPhrase = gsub("ingredients", "food", cleanedPhrase),
    cleanedPhrase = gsub("items sale", "items", cleanedPhrase),
    cleanedPhrase = gsub("items craft shop", "items", cleanedPhrase),
    cleanedPhrase = gsub("joggers predestrians", "jogger", cleanedPhrase),
    cleanedPhrase = gsub("light object", "object", cleanedPhrase),
    cleanedPhrase = gsub("loud sound", "sound", cleanedPhrase),
    cleanedPhrase = gsub("wood choices", "wood", cleanedPhrase),
    cleanedPhrase = gsub("meeting hall", "venue", cleanedPhrase),
    cleanedPhrase = gsub("mattress", "bedboard", cleanedPhrase),
    cleanedPhrase = gsub("merchandise", "items", cleanedPhrase),
    cleanedPhrase = gsub("musical instruments", "musical instrument", cleanedPhrase),
    cleanedPhrase = gsub("musical performance", "instruments", cleanedPhrase),
    cleanedPhrase = gsub("musical instrument", "instruments", cleanedPhrase),
    cleanedPhrase = gsub("musicals", "concert", cleanedPhrase),
    cleanedPhrase = gsub("neighborhood", "town", cleanedPhrase),
    cleanedPhrase = gsub("nests", "dens", cleanedPhrase),
    cleanedPhrase = gsub("noise room", "noise", cleanedPhrase),
    cleanedPhrase = gsub("noise nearby", "noise", cleanedPhrase),
    cleanedPhrase = gsub("normal pick up truck", "pick-up", cleanedPhrase),
    cleanedPhrase = gsub("objectsed", "objects", cleanedPhrase),
    cleanedPhrase = gsub("things garden", "things", cleanedPhrase),
    cleanedPhrase = gsub("outerwear", "coat", cleanedPhrase),
    cleanedPhrase = gsub("paint coverage", "paints", cleanedPhrase),
    cleanedPhrase = gsub("paint odors", "paint smells", cleanedPhrase),
    cleanedPhrase = gsub("paint scents", "paint smells", cleanedPhrase),
    cleanedPhrase = gsub("papers", "paper", cleanedPhrase),
    cleanedPhrase = gsub("park sound", "sound", cleanedPhrase),
    cleanedPhrase = gsub("parts of ", "", cleanedPhrase),
    cleanedPhrase = gsub("parts of a ", "", cleanedPhrase),
    cleanedPhrase = gsub("parts of his ", "", cleanedPhrase),
    cleanedPhrase = gsub("parts of the ", "", cleanedPhrase),
    cleanedPhrase = gsub("pastries", "desserts", cleanedPhrase),
    cleanedPhrase = gsub("peoples house", "house", cleanedPhrase),
    cleanedPhrase = gsub("pet birds", "birds", cleanedPhrase),
    cleanedPhrase = gsub("pet house", "pets", cleanedPhrase),
    cleanedPhrase = gsub("pick up", "pick-up", cleanedPhrase),
    cleanedPhrase = gsub("places htey", "venues", cleanedPhrase),
    cleanedPhrase = gsub("places forest", "forest", cleanedPhrase),
    cleanedPhrase = gsub("places darker", "places", cleanedPhrase),
    cleanedPhrase = gsub("places quiet", "places", cleanedPhrase),
    cleanedPhrase = gsub("places met", "venue", cleanedPhrase),
    cleanedPhrase = gsub("places live", "rentals", cleanedPhrase),
    cleanedPhrase = gsub("places sit", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("plant fibers", "materials", cleanedPhrase),
    cleanedPhrase = gsub("plays", "audios", cleanedPhrase),
    cleanedPhrase = gsub("pools", "places", cleanedPhrase),
    cleanedPhrase = gsub("precipitation", "stroms", cleanedPhrase),
    cleanedPhrase = gsub("predictions", "weather", cleanedPhrase),
    cleanedPhrase = gsub("premises", "walls", cleanedPhrase),
    cleanedPhrase = gsub("price of fruit", "price", cleanedPhrase),
    cleanedPhrase = ifelse( cleanedPhrase == "_price_", np_match_us, cleanedPhrase),
    cleanedPhrase = ifelse( cleanedPhrase == "_pieces_", np_match_us, cleanedPhrase),
    cleanedPhrase = ifelse( np == "sauna", gsub("spa", "sauna", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = ifelse( np == "bedboard", gsub("board", "bedboard", cleanedPhrase), cleanedPhrase),
    cleanedPhrase = gsub("heavy object", "objects", cleanedPhrase),  
    cleanedPhrase = gsub("primates", "monkey", cleanedPhrase),
    cleanedPhrase = gsub("produce", "food", cleanedPhrase),
    cleanedPhrase = gsub("programs", "entertainment", cleanedPhrase),
    cleanedPhrase = gsub("public areas", "areas", cleanedPhrase),
    cleanedPhrase = gsub("public places", "venue", cleanedPhrase),
    cleanedPhrase = gsub("recipe", "cookware", cleanedPhrase),
    cleanedPhrase = gsub("restaurant price", "restaurant", cleanedPhrase),
    cleanedPhrase = gsub("retail stores", "stores", cleanedPhrase),
    cleanedPhrase = gsub("room temperature liquids", "liquid", cleanedPhrase),
    cleanedPhrase = gsub("room temperatures", "temperature", cleanedPhrase),
    cleanedPhrase = gsub("rooms buildings venue", "venue", cleanedPhrase),
    cleanedPhrase = gsub("rowing", "rowboat", cleanedPhrase),
    cleanedPhrase = gsub("runnres", "runner", cleanedPhrase),
    cleanedPhrase = gsub("seasoning", "spice", cleanedPhrase),
    cleanedPhrase = gsub("seats", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("shopping", np_match, cleanedPhrase),
    cleanedPhrase = gsub("sitting surface", "furniture", cleanedPhrase),
    cleanedPhrase = gsub("snack food", "snacks", cleanedPhrase),
    cleanedPhrase = gsub("sound environment", "sound", cleanedPhrase),
    cleanedPhrase = gsub("sound of nature", "sound", cleanedPhrase),
    cleanedPhrase = gsub("spirits", "liquor", cleanedPhrase),
    cleanedPhrase = gsub("speed highway", "speed", cleanedPhrase),
    cleanedPhrase = gsub("spots", "venues", cleanedPhrase),
    cleanedPhrase = gsub("squirrel coat", "animal coat", cleanedPhrase),
    cleanedPhrase = gsub("study area", "area", cleanedPhrase),
    cleanedPhrase = gsub("substances", "materials", cleanedPhrase),
    cleanedPhrase = gsub("surfaces of bed", "bed", cleanedPhrase),
    cleanedPhrase = gsub("surrounding", "places", cleanedPhrase),
    cleanedPhrase = gsub("taller breeds", "dogs", cleanedPhrase),
    cleanedPhrase = gsub("temperatures room", "temperature", cleanedPhrase),
    cleanedPhrase = gsub("temporary shelters", "tents", cleanedPhrase),
    cleanedPhrase = gsub("terrariums", "terrarium", cleanedPhrase),
    cleanedPhrase = gsub("text", "script", cleanedPhrase),
    cleanedPhrase = gsub("things hardware store", "things", cleanedPhrase),
    cleanedPhrase = gsub("things craft shop", "things", cleanedPhrase),
    cleanedPhrase = gsub("things lake", "things", cleanedPhrase),
    cleanedPhrase = gsub("things eaten", "food", cleanedPhrase),
    cleanedPhrase = gsub("things lifted", "things", cleanedPhrase),
    cleanedPhrase = gsub("things air", "things", cleanedPhrase),
    cleanedPhrase = gsub("things airport", "things", cleanedPhrase),
    cleanedPhrase = gsub("things forest", "things", cleanedPhrase),
    cleanedPhrase = gsub("things kitchen", "things", cleanedPhrase),
    cleanedPhrase = gsub("things ocean", "things", cleanedPhrase),
    cleanedPhrase = gsub("things room", "things", cleanedPhrase),
    cleanedPhrase = gsub("things store", "things", cleanedPhrase),
    cleanedPhrase = gsub("things sky", "things", cleanedPhrase),
    cleanedPhrase = gsub("things terrarium", "things", cleanedPhrase),
    cleanedPhrase = gsub("things table", "things", cleanedPhrase),
    cleanedPhrase = gsub("things lake", "things", cleanedPhrase),
    cleanedPhrase = gsub("things fast", "things", cleanedPhrase),
    cleanedPhrase = gsub("things short", "things", cleanedPhrase),
    cleanedPhrase = gsub("things pick up", "things", cleanedPhrase),
    cleanedPhrase = gsub("things move", "things", cleanedPhrase),
    cleanedPhrase = gsub("tings weight", "things", cleanedPhrase),
    cleanedPhrase = gsub("trucks", "truck", cleanedPhrase),
    cleanedPhrase = gsub("wheeled transportation", "transportation", cleanedPhrase),
    cleanedPhrase = gsub("types of ", "", cleanedPhrase),
    cleanedPhrase = gsub("ways of travel", "transportation", cleanedPhrase),
    cleanedPhrase = gsub("ways of walking", "walking", cleanedPhrase),
    cleanedPhrase = gsub("wooffloor", "wood floor", cleanedPhrase),
    cleanedPhrase = gsub("writings", "script", cleanedPhrase),
    cleanedPhrase = gsub("works of art", superordinate, cleanedPhrase),
    cleanedPhrase = gsub("apartmet", "apartment", cleanedPhrase),
    cleanedPhrase = gsub("frozen desserts", "dessert", cleanedPhrase),
    cleanedPhrase = gsub("jogges walkers", "people", cleanedPhrase),
    cleanedPhrase = gsub("pickup", "pick-up", cleanedPhrase),
    cleanedPhrase = gsub("temperatures", "temperature", cleanedPhrase),
    cleanedPhrase = gsub("weights", "weight", cleanedPhrase),
         ) %>%
  mutate( cat_cleaned = gsub("_", "", cleanedPhrase),
    specific = containsString_responses(as.character(cleanedPhrase), as.character(np_match), cat_cleaned,  np_match_us), 
         matchingSuper = containsString_responses(as.character(cleanedPhrase), as.character(superordinate), cat_cleaned, super_us)
         )

d.tidy.phase.classifiedSuper %>% filter((specific == 0) & (matchingSuper == 0)) -> d.nonMatching.Super # %>% distinct(degree, superordinate, super_us, np, adj, np_match, np_match_us, originalResponse, cleanedPhrase, cat_cleaned, specific, matchingSuper) 

# the responses that are still classified as neither sub nor super do not match the anticipated responses and are mostly ones which occur fairly often. All of them are definitely not subordinate and will be classified as superordinate responses. 

# here, the responses including the scale are caught (174 responses)
d.scaleResps <- d.nonMatching.Super %>% rowwise() %>% mutate(degree_match = degree,
  degree_match = ifelse(degree == "temperature_h", "temperature", degree_match),
  degree_match = ifelse(degree == "speed_f", "speed", degree_match),
  degree_match = ifelse(degree == "loudness", "sound, noise", degree_match),
  degree_match = ifelse(degree == "loudness_n", "sound, noise", degree_match),
  degree_match = ifelse(degree == "length_duration", "length, duration", degree_match),
  degree_match = ifelse(degree == "strength", "weight", degree_match),
  ) %>% 
  filter(grepl(cat_cleaned, degree_match, ignore.case=T))

d.classified.super.wCC <- anti_join(d.tidy.phase.classifiedSuper, d.scaleResps) %>% select(stim_id, degree, context_sentence, superordinate, np, np_expectations, adj, adj_polarity, np_match, originalResponse, cat_cleaned, specific, matchingSuper)
# exclude the "degree" responses
d.AutoClassified <- d.matchedResponses  %>% select(stim_id, degree, context_sentence, superordinate, np, np_expectations, adj, adj_polarity, np_match, originalResponse, cat_cleaned = originalPhrase, specific, matchingSuper)
d.HandClassified.subs.wCC <- anti_join(d.tidy.phrase.handClassified, d.tidy.resp.analysis.update) %>% select(stim_id, degree, context_sentence, superordinate, np, np_expectations, adj, adj_polarity, np_match,originalResponse, cat_cleaned, specific, matchingSuper)
# put the whole classified data together to get modal responses
d.tidy.resps.classified.full <- rbind(d.classified.super.wCC, 
                                      rbind(d.AutoClassified, d.HandClassified.subs.wCC))

# some compounds should only be classified as superordinates
d.tidy.resps.classified.full <- d.tidy.resps.classified.full %>% mutate(specific = ifelse(originalResponse == "berries", 0, specific),
                                                                        specific = ifelse(originalResponse == "boat", 0, specific),
                                                                        specific = ifelse(originalResponse == "bird", 0, specific),
                                                                        specific = ifelse(originalResponse == "building", 0, specific),
                                                                        specific = ifelse(originalResponse == "cake", 0, specific),
                                                                        specific = ifelse(originalResponse == "concert", 0, specific),
                                                                        specific = ifelse(originalResponse == "flower", 0, specific),
                                                                        specific = ifelse(originalResponse == "guitar", 0, specific))
```

``` {r}
# check
d.tidy.resps.classified.full %>% 
  filter((specific == 1) & (matchingSuper == 1)) %>% 
  View() 
# all the responses that are classified as both are composite subordinates 

# check the full data set items which have mean 1 or 0

d.tidy.resps.classified.full %>% group_by(stim_id, np_expectations, adj_polarity) %>% mutate(meanSub = mean(specific),
                                                                                             ) %>% filter((meanSub == 0)| (meanSub == 1)) %>% select(stim_id, degree, np_match, adj_polarity, np_expectations, originalResponse, cat_cleaned, meanSub) %>% distinct() %>% View()
                             
                                                               
```

fabric . superordinate

```{r}
# d.tidy.phrase.specificMarking.bs <- d.tidy.phase.classifiedSuper %>% 
#   filter(!((specific == 0) & (matchingSuper == 0)))  %>% 
#   #mutate() %>%
  
d.tidy.phrase.specificMarking.bs <- d.tidy.clean.responses %>% 
  group_by(np_expectations, adj_polarity) %>%
  tidyboot_mean(column = specific)

# d.tidy.phrase.specificMarking.bs.item <- d.tidy.phase.classifiedSuper %>%
#   filter(!((specific == 0) & (matchingSuper == 0)))  %>% 
#   mutate() %>%
  
d.tidy.phrase.specificMarking.bs.item <- d.tidy.clean.responses %>%
  group_by( stim_id, degree, superordinate, np_expectations,  np, adj_polarity) %>%
  tidyboot_mean(column = specific)

d.tidy.phrase.specificMarking.bs %>% 
  ungroup() %>%
  mutate(np_expectations = gsub('\"', "", np_expectations),
         adj_polarity = gsub('\"', "", adj_polarity),
         np_expectations = factor(np_expectations,
                               levels = c("low", "medium", "high"))) -> d.tidy.phrase.specificMarking.bs

d.tidy.phrase.specificMarking.bs.item %>%
  ungroup() %>%
  mutate(unique_id = paste(stim_id, np_expectations, sep = "-")) %>%   mutate(np_expectations = factor(np_expectations,
                               levels = c("low", "medium", "high"))) ->  d.tidy.phrase.specificMarking.bs.item


set.seed(2020)

d.tidy.phrase.specificMarking.bs.item %>%
  left_join(., 
  data.frame(
    unique_id = unique(d.tidy.phrase.specificMarking.bs.item$unique_id),
    jitterVal = runif(270, min = -0.07, max = 0.07)
  )) %>%
  mutate(
    jitterVal = jitterVal + ifelse(adj_polarity == "positive", 0.2, -0.2)
    ) %>%
ggplot(., 
       aes( x = as.numeric(np_expectations) + jitterVal, y = mean, 
            ymin = ci_lower, ymax = ci_upper, fill = adj_polarity))+  
  geom_col(data = d.tidy.phrase.specificMarking.bs,
           aes( x = np_expectations, y = mean,
            ymin = ci_lower, ymax = ci_upper, fill = adj_polarity),
           position = position_dodge(0.8), width = 0.8, alpha = 0.6, color = 'black', size = 1)+

  geom_point(#position = position_dodge(0.8),
             #position = position_jitterdodge(jitter.width = 0.2, jitter.height = 0), 
             # data = d.tidy.phrase.specificMarking.bs.item,
             # aes( y = mean, fill = adj_polarity, x = np_expectations),
             shape = 21, alpha = 0.8)+
  geom_path(aes(group = unique_id), 
            #position = position_dodge(0.8),
            alpha = 0.15)+
  geom_linerange(data = d.tidy.phrase.specificMarking.bs, 
           aes( x = np_expectations, y = mean, 
            ymin = ci_lower, ymax = ci_upper),
           position = position_dodge(0.8), color = 'black', size = 1.5)+
  scale_fill_brewer(palette = "Set3")+
  theme(#axis.text.x = element_text(angle = 45, hjust = 1.0, vjust = 1),
        #axis.title.x = element_blank(),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.line = element_line(colour = "black"))+
  guides(fill= guide_legend(title = "Adjective polarity", reverse = T))+
 # theme_black()+
  scale_y_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1))+
  ylab("Proportion paraphrases that contain Specific NP")+
  xlab("Subordinate Category General Expectations")

 ggsave(filename = "../writing/paper/figs/bars_cc_finalExpt_prereg_bars_syncDodge.pdf",
        width = 6, height = 4)
```


```{r}
# look at data matched automatically by-item
d.confident.phrase.specificMarking.bs.item <- d.matchedResponses %>%
 # mutate() %>%
  group_by( stim_id, degree, superordinate, np_expectations,  np, adj_polarity) %>%
  mean(specific)

d.tidy.phrase.specificMarking.bs %>%
  ungroup() %>%
  mutate(np_expectations = gsub('\"', "", np_expectations),
         adj_polarity = gsub('\"', "", adj_polarity),
         np_expectations = factor(np_expectations,
                               levels = c("low", "medium", "high"))
) %>%
  ggplot(., 
       aes( x = np_expectations, y = mean, 
            ymin = ci_lower, ymax = ci_upper, fill = adj_polarity))+  
  geom_col(position = position_dodge(0.8), width = 0.8, alpha = 0.6, color = 'black', size = 1)+

  geom_point(position = position_jitterdodge(jitter.width = 0.2, jitter.height = 0), 
             data = d.tidy.phrase.specificMarking.bs.item,
             aes( y = mean, fill = adj_polarity, x = np_expectations),
             shape = 21, alpha = 0.8)+
  geom_linerange(position = position_dodge(0.8), color = 'black', size = 1)+
  scale_fill_brewer(palette = "Set3")+
  theme(#axis.text.x = element_text(angle = 45, hjust = 1.0, vjust = 1),
        #axis.title.x = element_blank(),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_blank(),
        axis.line = element_line(colour = "black"))+
 # theme_black()+
  scale_y_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1))+
  ylab("Proportion paraphrases that contain Specific NP")+
  xlab("Subordinate Category General Expectations")

 # ggsave(filename = "../writing/paper/figs/bars_cc_finalExpt_prereg_bars.pdf",
 #        width = 6, height = 4)
```

By-item plot

```{r figIndivItems}
# does not work
d.tidy.resps.classified.full  %>% 
  #mutate() %>%
  group_by( stim_id, np_expectations,  adj_polarity) %>%
  mutate(mean = mean( specific)) %>%
   ungroup() %>%
   mutate(np_expectations = gsub('\"', "", np_expectations),
          adj_polarity = gsub('\"', "", adj_polarity),
          np_expectations = factor(np_expectations,
                                   levels = c("low", "medium", "high")),
          np = fct_reorder(np, as.numeric(np_expectations)),
          item_set = paste(degree, " - ", superordinate, "-", stim_id, sep = "")) %>%
   ggplot(., 
          aes( x = np, y = mean, 
                fill = adj_polarity))+  
   geom_col(position = position_dodge(0.8), width = 0.8, alpha = 0.7, color = 'black')+
   #geom_linerange(position = position_dodge(0.8), color = 'black')+  
   scale_fill_brewer(palette = "Set3")+
   theme(axis.text.x = element_text(angle = 45, hjust = 1.0, vjust = 1),
         #axis.title.x = element_blank(),
         panel.grid.minor = element_blank(),
         panel.grid.major = element_blank(),
         axis.line = element_line(colour = "black"))+
   facet_wrap(~item_set, scales = 'free')+
   # theme_black()+
   scale_y_continuous(limits = c(-0.02, 1.02), breaks = c(0, 0.5, 1))+
   ylab("Proportion paraphrases that contain NP")+
   xlab("Subordinate Category Prior Mean") #-> bars_cc_finalExpt_prereg_confident_byItem

 # ggsave("../analysis/figs/bars_cc_finalExpt_pilot_byItem.png",
 #        width = 9, height = 9)
 ggsave(bars_cc_finalExpt_prereg_prelim_byItem, 
        filename = "../writing/paper/figs/bars_cc_finalExpt_prereg_prelim_byItem3.png",
        width = 18, height = 18)
```


## Look at items with n>=35

```{r}

d.item.n35 <- d.item.count %>%
  filter(n >= 35) %>%
  mutate(unique_id = paste(stim_id, np_expectations, adj_polarity, sep = "_")) %>%
  pull(unique_id)


d.item.n35.bs <- d.tidy.phrase.w.original %>%
  mutate(unique_id = paste(stim_id, np_expectations, adj_polarity, sep = "_")) %>%
  filter(unique_id %in% d.item.n35) %>%
  group_by(stim_id, np_expectations, adj_polarity) %>%
  summarize(n_sum = sum(specific), n = n())
```




The data points are grouped by stim id, NP expectation, adjective polarity and specificity and the number of occurances of each response is calculated. The most common responses (both subordinate and superordinate) will be used for the adjective endorsement task. 
``` {r}

# the superordinate for the NPs where the modal responses did not match the anticipated one are substituted to the modal participant response 

# extract the mode response 
d.tidy.resp.counts <- d.tidy.resps.classified.full %>% 
  group_by(stim_id, superordinate, np_match, np_expectations, adj_polarity, specific, cat_cleaned) %>% count() %>% 
  mutate(n_unique_resps = n) %>% ungroup()

# insert the mode NP (modal subordinate where participants gave subordinate response, modal superordinate where they gave superordinate response)
# in column mode
d.tidy.resp.counts <- d.tidy.resp.counts %>% group_by(stim_id, superordinate, np_match, adj_polarity, specific) %>% mutate(mode = cat_cleaned[which.max(n)] )


# analysis of modal responses
d.tidy.resp.counts.analysis <- d.tidy.resp.counts %>% rowwise() %>%  
  mutate(isModeNP =containsString_responses(as.character(paste("_", np_match, "_", sep="")), as.character(mode), 
                                            np_match, as.character(paste("_", mode, "_", sep=""))),
        isModeSuper = containsString_responses(as.character(paste("_", superordinate, "_", sep="")), as.character(mode), 
                                            superordinate, as.character(paste("_", mode, "_", sep=""))),
        isModeNeither = sum(isModeNP, isModeSuper),
        mode = gsub("_", "", mode)) # isModeNeither = 0 means that the mode response is different from anticipated NPs
d.tidy.resp.counts.analysis %>% filter(isModeNeither == 0) %>% distinct(stim_id, degree, superordinate, np_match, specific, adj_polarity, mode) %>% View()

# the superordinate will be substituted for those items where the mode deviates for 6 or more items of a set (set is 12 variations of an item: 3 np_expectations x 2 adj_polarities x 2 CC types, specific and not ) and the deviating modal response is the same for 6 or more items
d.tidy.resp.counts.analysis %>% filter(isModeNeither == 0) %>% distinct(stim_id, degree, superordinate, np_match, specific, adj_polarity, mode) %>% count(stim_id, mode) %>% View()
#%>% filter(n >= 6) -> stim.ids.adjust

d.tidy.resp.counts.analysis %>% filter(isModeNeither == 0) %>% distinct(stim_id, degree, superordinate, np_match, specific, adj_polarity, mode) %>% right_join(., stim.ids.adjust, by = c("stim_id") ) %>% View()


```

``` {r}
# the data is adjusted to the human modal responses for stim_ids 5 and 77

# plural noun phrases are adjusted to the frequency queries 
d.tidy.resps.classified.full.adjust.Super <- d.tidy.resps.classified.full %>% 
  mutate(
        # substitutions made based on human modal responses 
        superordinate = ifelse(stim_id == 5, "scripts", superordinate),
        superordinate = ifelse(stim_id == 77, "food", superordinate)
         ) %>% 
  # if the response is specific (subordinate), the modal NP is inserted, otherwise the modal superordinate is inserted 
  mutate(mode_np = ifelse(specific == 1, np, superordinate))

#write_csv(d.tidy.resps.classified.full.adjust.Super, '../data/class-elicitation-prereg-final/class-elicitation-final-full_analysis_w_adjusted_super.csv')
``` 

``` {r frequencies}
# data is prepared for frequency extraction: the freuqncies for plural forms of the NPs and the most superordinatesare pulled, so the plural NPs are added
 
# THE ORIGINAL NPs ARE USED, NOT THE SUBSTITUTED ONES
insert_plural_np = function(np, superordinate) {
   if (np %in% c("piece of chocolate" )) {
    np_pl = "chocolates"
  } else if (np %in% c("piece of chalk" )) {
    np_pl = "chalks"  
  } else if( np %in% c("story")) {
    np_pl = "stories" 
  } else if( np %in% c("daisy")) {
    np_pl = "daisies"   
  } else if( np %in% c("library")) {
    np_pl = "libraries"   
  } else if( np %in% c("party")) {
    np_pl = "parties" 
  } else if( np %in% c("bush")) {
    np_pl = "bushes"  
  } else if( np %in% c("finch")) {
    np_pl = "finches"    
  } else if( np %in% c("pansy")) {
    np_pl = "pansies"
  } else if ( np %in% c("documentary")) {
    np_pl = "documentaries"   
  } else if ( np %in% c("pantry")) {
    np_pl = "pantries"
  } else if ( np %in% c("choral concert")) {
    np_pl = "choirs"  
  } else if( np %in% c("elderly person")) {
    np_pl = "elderly people"   
  } else if( np %in% c("mouse")) {
    np_pl = "mice"
  } else if( np %in% c("church")) {
    np_pl = "churches"  
  } else if( np %in% c("tile")) {
    np_pl = "tile floors"
  } else if( np %in% c("wood") & (superordinate == "floors")) {
    np_pl = "wood floors"  
  } else if( np %in% c("carpet") & (superordinate == "floors")) {
    np_pl = "carpet floors"    
  } else if( np %in% c("summer")) {
    np_pl = "summer days" 
  } else if( np %in% c("fall")) {
    np_pl = "fall days"   
  } else if( np %in% c("winter")) {
    np_pl = "winter days"   
  } else if( np %in% c("couch")) {
    np_pl = "couches"  
  } else if( np %in% c("tomato")) {
    np_pl = "tomatoes"
  } else if( np %in% c("jolly rancher")) {
    np_pl = "jollies"
  } else if( np %in% c("peach")) {
    np_pl = "peaches"
  } else if( np %in% c("city")) {
    np_pl = "cities"   
  } else if( np %in% c("auditorium")) {
    np_pl = "auditoria"
  } else if (np %in% c("bottle of top-shelf liquor")) {
    np_pl = "liquors"
  } else if (np %in% c("six-pack of beer")) {
    np_pl = "beers"
  } else if (np %in% c( "bottle of wine")) {
    np_pl = "wine bottles"
  } else if (np %in% c( "bush" )) {
    np_pl = "bushes"
  } else if (np %in% c( "mouse den" )) {
    np_pl = "mouse holes"
  } else if (np %in% c( "sprinting race" )) {
    np_pl = "sprints"  
  } else if(np %in% c( "child")) {
    np_pl = "children"
  } else if (np %in% c("baby")) {
    np_pl = "babies"
  } else if (np %in% c("platinum")) {
    np_pl = "platinum statue"
  } else if( np %in% c("bronze")) {
    np_pl = "bronze statues"   
  } else if( np %in% c("pick-up truck")) {
    np_pl = "pick up trucks"     
  } else if ((np %in% c("plastic")) & (superordinate == "bracelets")) {
    np_pl = "plastic bracelets"
  } else if( np %in% c("gold")) {
    np_pl = "gold bracelets"
  } else if( np %in% c("metal")) {
    np_pl = "metal bracelets"  
  } else if ((np %in% c("plastic")) & (superordinate == "statues")) {
    np_pl = "plastic statues"  
  } else if (np %in% c("wool", "wood", "fish", "ice cream", "garlic", "saffron", "coffee", "raspberries",
                       "boysenberries",
                "strawberries", "sneakers", "chicken", "boots", "tuna", "pork", "sandals", "plastic", "instant pot"))  {
    np_pl = np # the items left singular
    
  } else {
    np_pl = paste(np, "s", sep="")
  }
  return (np_pl)
}

d.tidy.resps.w.pl.np <- d.tidy.resps.classified.full.adjust.Super %>% 
  rowwise() %>% 
  mutate(np_pl = insert_plural_np(tolower(np), superordinate))

# adjust some superordinates 
d.tidy.resps.w.pl.np <- d.tidy.resps.w.pl.np %>%
  mutate(superordinate.freq = superordinate,
    superordinate.freq = ifelse(superordinate == "venue", "venues", superordinate.freq),
    superordinate.freq = ifelse(superordinate == "races", "rallies", superordinate.freq) # avois polysemy
         )
# this data can be fed into python frequency extractor
#write_csv(d.tidy.resps.w.pl.np, '../data/class-elicitation-prereg-final/class-elicitation-final-full_analysis_w_pl_np.csv')
```

``` {r}
df.frequencies <- read_csv('../data/class-elicitation-prereg-final/class-elicitation-final-plural_frequencies.csv')
d.tidy.phrase.w.original.mode.pl <- d.tidy.resps.w.pl.np %>%
  left_join(., df.frequencies, by = c("np_pl" ="NPs")) %>% # add subordinate frequencies
  left_join(., df.frequencies, by=c("superordinate.freq"="NPs"))   # add superordinate frequencies

df.mode.final <- d.tidy.phrase.w.original.mode.pl %>% select(workerid, degree, superordinate_sg, superordinate, adj, adj_positiveness, np, np_for_freq, mode_np, specific, Frequencies.x.x, Frequencies.y.y) %>% mutate(superordinate_sg = superordinate_sg, superordinate_pl = superordinate, NP_sg = np, NP_pl = np_for_freq,  response = mode_np, subFreq = Frequencies.x.x, superFreq = Frequencies.y.y) %>% select(workerid, degree, superordinate_sg, superordinate_pl, adj, adj_positiveness, NP_sg, NP_pl, response, specific, subFreq, superFreq)

# check if singular matches original
df.sg <- read_csv('../data/pilot-classElicitation-free-4/class-elicitation-free-4-cleaned-data-w-sub2.csv')
anti_join(df.mode.final, df.sg, by = c("specific" = "specific")) %>% View()


#write_csv(df.mode.final, '../data/pilot-classElicitation-free-4/class-elicitation-free-4-cleaned-data-SG-PL-update.csv')
```

# Viz: First prass

```{r figCollapseItems}
d.tidy.phrase.specificMarking.bs <- d.tidy.phrase.w.original %>% 
  mutate() %>%
  group_by(np_positiveness,  adj_positiveness) %>%
  tidyboot_mean(column = specific)

# d.tidy.phrase.specificMarking.bs %>%
#   ungroup() %>%
#   mutate(np_positiveness = gsub('\"', "", np_positiveness),
#          adj_positiveness = gsub('\"', "", adj_positiveness),
#          np_positiveness = factor(np_positiveness,
#                                levels = c("negative", "neither-nor", "positive"),
#                                labels = c("low", "medium", "high")
# )) %>%
#   rename(adj_polarity = adj_positiveness) %>%
#   ggplot(., 
#        aes( x = np_positiveness, y = mean, 
#             ymin = ci_lower, ymax = ci_upper, fill = adj_polarity))+  
#   geom_col(position = position_dodge(0.8), width = 0.8, alpha = 0.7, color = 'black')+
#   geom_linerange(position = position_dodge(0.8), color = 'black')+  
#   scale_fill_brewer(palette = "Set3")+
#   theme(axis.text.x = element_text(angle = 45, hjust = 1.0, vjust = 1),
#         #axis.title.x = element_blank(),
#         panel.grid.minor = element_blank(),
#         panel.grid.major = element_blank(),
#         axis.line = element_line(colour = "black"))+
#  # theme_black()+
#   scale_y_continuous(limits = c(0, 1), breaks = c(0, 0.5, 1))+
#   ylab("Proportion paraphrases that contain NP")+
#   xlab("Subordinate Category Prior Mean")




# ggsave("../analysis/figs/bars_cc_finalExpt_pilot.png",
#        width = 5, height = 3.6)
```


# by item


add superordinate labels
```{r}
df.adj <- read_csv("../data/pilot-adj-endorsement-1/pilot-adj-endorsement-1-trials.csv")

df.adj %>% 
  distinct(item, superordinate) -> df.super
```


# Regression modeling


### Simulate data to get contrast coding right

```{r}
simulated.data <- bind_rows(
  data.frame(
    np = "mid",
    adj = "short",
    x = rnorm(n = 20, mean = 1, sd = 0.5)
  ),
  data.frame(
    np = "mid",
    adj = "tall",
    x = rnorm(n = 20, mean = 1, sd = 0.5)
  ), 
  data.frame(
    np = "low",
    adj = "short",
    x = rnorm(n = 20, mean = 0.5, sd = 0.5)
  ),
  data.frame(
    np = "low",
    adj = "tall",
    x = rnorm(n = 20, mean = 1.5, sd = 0.5)
  ), 
  data.frame(
    np = "high",
    adj = "short",
    x = rnorm(n = 20, mean = 1.5, sd = 0.5)
  ),
  data.frame(
    np = "high",
    adj = "tall",
    x = rnorm(n = 20, mean = 0.5, sd = 0.5)
  )
) %>%
  mutate(np = factor(np, levels = c("mid", "low", "high")),
         adj = factor(adj, levels = c("short", "tall")))

simulated.data.means <- simulated.data %>%
  group_by(np, adj) %>%
  summarize(m = mean(x)) 

simulated.data.means %>%
  ggplot(., aes (x = np, y = m, fill = adj))+
  geom_col(position = position_dodge())


contrasts(simulated.data$adj) <- c(-0.5, 0.5)

contrasts(simulated.data$np) 

lm.sim<- lm(x ~ np*adj, data = simulated.data)

lm.sim.summ <- summary(lm.sim)

sim.int <- lm.sim.summ$coefficients[["(Intercept)", "Estimate"]]
sim.beta_adj <- lm.sim.summ$coefficients[["adj1", "Estimate"]]
sim.beta_npLow <- lm.sim.summ$coefficients[["nplow", "Estimate"]]
sim.beta_npHigh <- lm.sim.summ$coefficients[["nphigh", "Estimate"]]
sim.beta_npLow_adj <- lm.sim.summ$coefficients[["nplow:adj1", "Estimate"]]
sim.beta_npHigh_adj <- lm.sim.summ$coefficients[["nphigh:adj1", "Estimate"]]

print(
  paste(
    "actual mean of MID tall" ,  
    simulated.data.means %>% filter(np == "mid", adj == "tall") %>% pull(m),
    "model prediction", 
    sim.int + 0.5 * sim.beta_adj
  )
)

print(
  paste(
    "actual mean of MID short" ,  
    simulated.data.means %>% filter(np == "mid", adj == "short") %>% pull(m),
    "model prediction", 
    sim.int - 0.5 * sim.beta_adj
  )
)

print(
  paste(
    "actual mean of HIGH tall" ,  
    simulated.data.means %>% filter(np == "high", adj == "tall") %>% pull(m),
    "model prediction", 
    sim.int + 0.5 * sim.beta_adj + sim.beta_npHigh + 0.5 * sim.beta_npHigh_adj
  )
)

print(
  paste(
    "actual mean of HIGH short" ,  
    simulated.data.means %>% filter(np == "high", adj == "short") %>% pull(m),
    "model prediction", 
    sim.int - 0.5 * sim.beta_adj + sim.beta_npHigh - 0.5 * sim.beta_npHigh_adj
  )
)

print(
  paste(
    "actual mean of LOW tall" ,  
    simulated.data.means %>% filter(np == "low", adj == "tall") %>% pull(m),
    "model prediction", 
    sim.int + 0.5 * sim.beta_adj + sim.beta_npLow + 0.5 * sim.beta_npLow_adj
  )
)

print(
  paste(
    "actual mean of LOW short" ,  
    simulated.data.means %>% filter(np == "low", adj == "short") %>% pull(m),
    "model prediction", 
    sim.int - 0.5 * sim.beta_adj + sim.beta_npLow - 0.5 * sim.beta_npLow_adj
  )
)
```


```{r}
d.tidy.clean.responses.fac <- d.tidy.clean.responses %>%
  mutate(adj_polarity = factor(adj_polarity, 
                                   levels = c("negative", "positive")),
         np_expectations = factor(np_expectations, 
                                  levels = c("medium", "low", "high")))

d.tidy.clean.responses.fac$stim_id <- as.factor(d.tidy.clean.responses.fac$stim_id)
d.tidy.clean.responses.fac$workerid <- as.factor(d.tidy.clean.responses.fac$workerid)

contrasts(d.tidy.clean.responses.fac$adj_polarity) <- c(-1/2, 1/2)

rs.glm.brm <- brm(
  formula = specific ~ np_expectations * adj_polarity + 
    (1 +  np_expectations*adj_polarity | workerid) + 
    (1 +  np_expectations*adj_polarity | stim_id),
  family = bernoulli(), chains = 3, cores = 3, iter = 1000,
  data = d.tidy.clean.responses.fac)


rs.glm.brm.summary <- summary(rs.glm.brm)

rs.glm.brm.summary

```

```{r}
write_csv(data.frame(rs.glm.brm.summary[["fixed"]]) %>% 
            mutate(Rowname = row.names(.)), 
          path = "../writing/paper/csv_data_4_tex/expt3_brm_pilot.csv")
```

```{r}
rs.glm <- glmer(
  formula = specific ~ np_positiveness * adj_positiveness + 
    (1 | workerid) + 
    (1 | superordinate),
  family = 'binomial', 
  data = d.tidy.phrase.w.original.fac)

contrasts(d.tidy.phrase.w.original.fac$np_positiveness)

summary(rs.glm)
```



